'Imports System.Web.UI.HtmlControls
'Imports System.Text
'Imports System.Web.UI.WebControls

'Namespace _Library._Web

'    Public Class htmlArea
'        Private mPage As Web.UI.Page
'        Private mEditorURL As String = ""
'        Private mShowAbout As Boolean = False
'        Private mTbEnabled As Boolean = True
'        Private mQuoteBoxItems As New ListItemCollection
'        Private mInsertImageOnClick As String = ""

'#Region "htmlAREA html files and gif files variables "
'        Private Popup_about_html As String
'        Private Popup_blank_html As String
'        Private Popup_custom2_html As String
'        Private Popup_editor_help_html As String
'        Private Popup_fullscreen_html As String
'        Private Popup_insert_image_html As String
'        Private Popup_insert_table_html As String
'        Private Popup_select_color_html As String

'        Private Images_ed_about_gif As String
'        Private Images_ed_align_center_gif As String
'        Private Images_ed_align_left_gif As String
'        Private Images_ed_align_right_gif As String
'        Private Images_ed_blank_gif As String
'        Private Images_ed_charmap_gif As String
'        Private Images_ed_color_bg_gif As String
'        Private Images_ed_color_fg_gif As String
'        Private Images_ed_copy_gif As String
'        Private Images_ed_custom_gif As String
'        Private Images_ed_cut_gif As String
'        Private Images_ed_delete_gif As String
'        Private Images_ed_format_bold_gif As String
'        Private Images_ed_format_italic_gif As String
'        Private Images_ed_format_strike_gif As String
'        Private Images_ed_format_sub_gif As String
'        Private Images_ed_format_sup_gif As String
'        Private Images_ed_format_underline_gif As String
'        Private Images_ed_help_gif As String
'        Private Images_ed_hr_gif As String
'        Private Images_ed_html_gif As String
'        Private Images_ed_removehtml_gif As String

'        Private Images_ed_image_gif As String
'        Private Images_ed_indent_less_gif As String
'        Private Images_ed_indent_more_gif As String
'        Private Images_ed_link_gif As String
'        Private Images_ed_list_bullet_gif As String
'        Private Images_ed_list_num_gif As String
'        Private Images_ed_redo_gif As String
'        Private Images_ed_undo_gif As String
'        Private Images_fullscreen_maximize_gif As String
'        Private Images_fullscreen_minimize_gif As String
'        Private Images_insert_table_gif As String

'#End Region

'        Public Sub New(ByVal BasePage As System.Web.UI.Page, ByVal EditorURL As String)
'            mPage = BasePage
'            mEditorURL = EditorURL
'            'POPUP HTML FILES
'            Popup_about_html = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "about.html")
'            Popup_blank_html = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "blank.html")
'            Popup_custom2_html = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "custom2.html")
'            Popup_editor_help_html = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "editor_help.html")
'            Popup_fullscreen_html = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "fullscreen.html")
'            Popup_insert_image_html = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "insert_image.html")
'            Popup_insert_table_html = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "insert_table.html")
'            Popup_select_color_html = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "select_color.html")
'            'IMAGES
'            Images_ed_about_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_about.jpg")
'            Images_ed_align_center_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_align_center.jpg")
'            Images_ed_align_left_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_align_left.jpg")
'            Images_ed_align_right_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_align_right.jpg")
'            Images_ed_blank_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_blank.jpg")
'            Images_ed_charmap_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_charmap.jpg")
'            Images_ed_color_bg_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_color_bg.jpg")
'            Images_ed_color_fg_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_color_fg.jpg")
'            Images_ed_copy_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_copy.jpg")
'            Images_ed_custom_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_custom.jpg")
'            Images_ed_cut_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_cut.jpg")
'            Images_ed_delete_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_delete.jpg")
'            Images_ed_format_bold_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_format_bold.jpg")
'            Images_ed_format_italic_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_format_italic.jpg")
'            Images_ed_format_strike_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_format_strike.jpg")
'            Images_ed_format_sub_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_format_sub.jpg")
'            Images_ed_format_sup_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_format_sup.jpg")
'            Images_ed_format_underline_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_format_underline.jpg")
'            Images_ed_help_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_help.jpg")
'            Images_ed_hr_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_hr.jpg")
'            Images_ed_html_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_html.jpg")
'            Images_ed_removehtml_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_removehtml.jpg")

'            Images_ed_image_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_image.jpg")
'            Images_ed_indent_less_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_indent_less.jpg")
'            Images_ed_indent_more_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_indent_more.jpg")
'            Images_ed_link_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_link.jpg")
'            Images_ed_list_bullet_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_list_bullet.jpg")
'            Images_ed_list_num_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_list_num.jpg")
'            Images_ed_redo_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_redo.jpg")
'            Images_ed_undo_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "ed_undo.jpg")
'            Images_fullscreen_maximize_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "fullscreen_maximize.jpg")
'            Images_fullscreen_minimize_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "fullscreen_minimize.jpg")
'            Images_insert_table_gif = mPage.ClientScript.GetWebResourceUrl(Me.GetType(), "insert_table.jpg")
'        End Sub

'        Public Property QuoteBoxItems() As ListItemCollection
'            Get
'                Return mQuoteBoxItems
'            End Get
'            Set(ByVal value As ListItemCollection)
'                mQuoteBoxItems = value
'            End Set
'        End Property

'        Public Property InsertImage_OnClick() As String
'            Get
'                Return mInsertImageOnClick
'            End Get
'            Set(ByVal value As String)
'                mInsertImageOnClick = value
'            End Set
'        End Property

'        Friend Property ToolbarVisible() As Boolean
'            Get
'                Return mTbEnabled
'            End Get
'            Set(ByVal value As Boolean)
'                mTbEnabled = value
'            End Set
'        End Property

'        Public Function Register() As Boolean
'            'htmlAREA Script
'            Dim mCtrl As New HtmlGenericControl
'            mCtrl.InnerHtml = EditorSCript()
'            mCtrl.ID = "HTMLAREASCRIPT"
'            If mPage.Header.FindControl(mCtrl.ID) Is Nothing Then
'                mPage.Header.Controls.Add(mCtrl)
'            End If
'            mCtrl = Nothing

'        End Function

'        'Public Function AssociateTextAreaControlScript(ByVal AssociatedControl_ID As object) As HtmlGenericControl
'        Public Function AssociateTextAreaControlScript(ByVal AssociatedControl_ID As String, ByVal pOnContentChange As String, Optional ByVal SatusControlName As String = "", Optional ByVal MaxChars As Integer = 0) As HtmlGenericControl
'            'TextArea Script
'            Dim mCtrl As New HtmlGenericControl
'            If String.IsNullOrEmpty(SatusControlName) Then
'                mCtrl.InnerHtml = TextAreaScript(AssociatedControl_ID, pOnContentChange)
'            Else
'                mCtrl.InnerHtml = TextAreaScript(AssociatedControl_ID, pOnContentChange, SatusControlName, MaxChars)
'            End If
'            Return mCtrl
'        End Function

'        Public Function EnablePostBackScript(ByVal pID As String) As HtmlGenericControl
'            Dim mCtrl As New HtmlGenericControl
'            mCtrl.ID = pID
'            mCtrl.InnerHtml = PostBackScript()
'            Return mCtrl
'        End Function

'        Private Function PostBackScript() As String
'            Dim mScript As New StringBuilder
'            mScript.AppendLine("<script type=""text/javascript"">")
'            mScript.AppendLine("<!--")
'            'mScript.AppendLine("var theForm = document.forms['form1'];")
'            mScript.AppendLine("var theForm = document.forms.item(0);")
'            mScript.AppendLine("if (!theForm) {")
'            'mScript.AppendLine("    theForm = document.form1;")
'            mScript.AppendLine("    alert('Multicontrol ___DoPostBack(). forms(0) not found.\n\n Multicontrol will not function properly');")
'            mScript.AppendLine("}")
'            mScript.AppendLine("function ___doPostBack(eventTarget, eventArgument) {")
'            mScript.AppendLine("    if (!theForm.onsubmit || (theForm.onsubmit() != false)) {")
'            mScript.AppendLine("        theForm.___EVENTTARGET.value = eventTarget;")
'            mScript.AppendLine("        theForm.___EVENTARGUMENT.value = eventArgument;")
'            mScript.AppendLine("        theForm.submit();")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("}")
'            mScript.AppendLine("-->")
'            mScript.AppendLine("</script>")

'            mScript.AppendLine("<input type=""hidden"" name=""___EVENTTARGET"" id=""___EVENTTARGET"" value="""" />")
'            mScript.AppendLine("<input type=""hidden"" name=""___EVENTARGUMENT"" id=""___EVENTARGUMENT"" value="""" />")
'            Return mScript.ToString
'        End Function

'        Private Function TextAreaScript(ByVal FieldName As String, ByVal pOnContentChange As String, Optional ByVal StatusControlName As String = "", Optional ByVal MaxChars As Integer = 0) As String
'            Dim mScript As New StringBuilder
'            mScript.AppendLine("<script language=""JavaScript1.2"" defer> ")
'            mScript.AppendLine("<!--")
'            mScript.AppendLine("editor_generate('" & FieldName & "'," & IIf(ToolbarVisible, "false", "true") & ");")
'            If String.IsNullOrEmpty(StatusControlName) Then
'                mScript.AppendLine("function " & FieldName & "_ST(Chars,Words) {")
'                mScript.AppendLine(pOnContentChange)
'                mScript.AppendLine("}")
'            Else
'                mScript.AppendLine("function " & FieldName & "_ST(Chars,Words,Dummy) {")
'                mScript.AppendLine("    var mW = Words;")
'                mScript.AppendLine("    var mC = Chars;")
'                mScript.AppendLine("    var mR = " & MaxChars & "-mC;")
'                'mScript.AppendLine("    document.getElementById('" & StatusControlName & "').innerHTML = 'W:&nbsp;'+mW+'&nbsp;&nbsp;||&nbsp;&nbsp;C:&nbsp;'+mC+'&nbsp;&nbsp;||&nbsp;&nbsp;R:&nbsp;<span '+((mR<0)?'style=""color:red""':'')+'>'+mR+'</span>'")
'                mScript.AppendLine("    document.getElementById('" & StatusControlName & "').innerHTML = '&nbsp;&nbsp;C:&nbsp;'+mC+'&nbsp;&nbsp;||&nbsp;&nbsp;R:&nbsp;<span '+((mR<0)?'style=""color:red""':'')+'>'+mR+' '+ ((mR<0)?'Warning: Limit exceeded':'') +'</span>'")
'                mScript.AppendLine(pOnContentChange)
'                mScript.AppendLine("}")
'            End If
'            mScript.AppendLine("-->")
'            mScript.AppendLine("</script>")
'            Return mScript.ToString
'        End Function

'        Private Function EditorSCript(Optional ByVal NoPopupEditor As Boolean = False) As String
'            Dim mScript As New StringBuilder
'            Dim mScr2 As ArrayList = Me.EditorScript3()
'            Dim mComma As String = ""

'            mScript.AppendLine("<script language=""Javascript1.2"">")
'            mScript.AppendLine("<!--")
'            mScript.AppendLine(" var mBigScript = new Array(" & mScr2.Count & ");")
'            mScript.AppendLine("")
'            mScript.AppendLine("_editor_url = """ & mEditorURL & """;                     ")
'            mScript.AppendLine("document.write('<style type=""text/css"">\n');")
'            mScript.AppendLine("document.write('.btn     { width: 22px; height: 22px; border: 1px solid buttonface; margin: 0; padding: 0; }\n');")
'            mScript.AppendLine("document.write('.btnOver { width: 22px; height: 22px; border: 1px outset; }\n');")
'            mScript.AppendLine("document.write('.btnDown { width: 22px; height: 22px; border: 1px inset; background-color: buttonhighlight; }\n');")
'            mScript.AppendLine("document.write('.btnNA   { width: 22px; height: 22px; border: 1px solid buttonface; filter: alpha(opacity=25); }\n');")
'            mScript.AppendLine("document.write('.cMenu     { background-color: threedface; color: menutext; cursor: Default; font-family: MS Sans Serif; font-size: 8pt; padding: 2 12 2 16; }');")
'            mScript.AppendLine("document.write('.cMenuOver { background-color: highlight; color: highlighttext; cursor: Default; font-family: MS Sans Serif; font-size: 8pt; padding: 2 12 2 16; }');")
'            mScript.AppendLine("document.write('.cMenuDivOuter { background-color: threedface; height: 9 }');")
'            mScript.AppendLine("document.write('.cMenuDivInner { margin: 0 4 0 4; border-width: 1; border-style: solid; border-color: threedshadow threedhighlight threedhighlight threedshadow; }');")
'            mScript.AppendLine("document.write('</style>\n');")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_defaultConfig(objname) {")
'            mScript.AppendLine("")
'            mScript.AppendLine("this.version = ""2.03""")
'            mScript.AppendLine("")
'            mScript.AppendLine("this.width =  ""auto"";")
'            mScript.AppendLine("this.height = ""auto"";")
'            mScript.AppendLine("this.bodyStyle = 'background-color: #FFFFFF; font-family: ""Verdana""; font-size: x-small;';")
'            mScript.AppendLine("this.imgURL = _editor_url + ''; ")
'            mScript.AppendLine("this.debug  = 0;")
'            mScript.AppendLine("")
'            mScript.AppendLine("this.replaceNextlines = 0; ")
'            mScript.AppendLine("this.plaintextInput = 0;   ")
'            mScript.AppendLine("")
'            mScript.AppendLine("this.toolbar = [")
'            mScript.AppendLine("    ['fontname'],")
'            mScript.AppendLine("    ['fontsize'],")
'            mScript.AppendLine("    ['bold','italic','underline','separator'],")
'            mScript.AppendLine("    ['justifyleft','justifycenter','justifyright','separator'],")
'            mScript.AppendLine("    ['OrderedList','UnOrderedList','Outdent','Indent','separator'],")
'            mScript.AppendLine("    ['forecolor','backcolor','separator'],")
'            mScript.AppendLine("    ['HorizontalRule','Createlink','InsertImage','InsertTable','htmlmode','separator'],")
'            mScript.AppendLine("    ['quotebox','removehtml','separator'],")
'            mScript.AppendLine("    ['popupeditor'" & IIf(mShowAbout, ",'about'", "") & "]];")
'            mScript.AppendLine("")
'            mScript.AppendLine("this.quoteboxs = {")
'            mScript.AppendLine("""Select QuoteBox"":  """"")
'            mComma = ","
'            For Each mLi As ListItem In QuoteBoxItems
'                mScript.AppendLine(mComma & """" & mLi.Text & """:  """ & Replace(Replace(mLi.Value, "'", "[SQ]"), """", "[DQ]") & """")
'            Next

'            mScript.AppendLine("};")

'            mScript.AppendLine("")
'            mScript.AppendLine("this.fontnames = {")
'            mScript.AppendLine("    ""Arial"":           ""arial, helvetica, sans-serif"",")
'            mScript.AppendLine("    ""Courier New"":     ""courier new, courier, mono"",")
'            mScript.AppendLine("    ""Georgia"":         ""Georgia, Times New Roman, Times, Serif"",")
'            mScript.AppendLine("    ""Tahoma"":          ""Tahoma, Arial, Helvetica, sans-serif"",")
'            mScript.AppendLine("    ""Times New Roman"": ""times new roman, times, serif"",")
'            mScript.AppendLine("    ""Verdana"":         ""Verdana, Arial, Helvetica, sans-serif"",")
'            mScript.AppendLine("    ""impact"":          ""impact"",")
'            mScript.AppendLine("    ""WingDings"":       ""WingDings""};")
'            mScript.AppendLine("")
'            mScript.AppendLine("this.fontsizes = {")
'            mScript.AppendLine("    ""1 (8 pt)"":  ""1"",")
'            mScript.AppendLine("    ""2 (10 pt)"": ""2"",")
'            mScript.AppendLine("    ""3 (12 pt)"": ""3"",")
'            mScript.AppendLine("    ""4 (14 pt)"": ""4"",")
'            mScript.AppendLine("    ""5 (18 pt)"": ""5"",")
'            mScript.AppendLine("    ""6 (24 pt)"": ""6"",")
'            mScript.AppendLine("    ""7 (36 pt)"": ""7""")
'            mScript.AppendLine("  };")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("this.fontstyles = [     // make sure these exist in the header of page the content is being display as well in or they won't work!")
'            mScript.AppendLine("];")
'            mScript.AppendLine("")
'            mScript.AppendLine("this.btnList = {")
'            mScript.AppendLine("    ""bold"":           ['Bold',                 'Bold',               'editor_action(this.id)',  '" & Images_ed_format_bold_gif & "'],")
'            mScript.AppendLine("    ""italic"":         ['Italic',               'Italic',             'editor_action(this.id)',  '" & Images_ed_format_italic_gif & "'],")
'            mScript.AppendLine("    ""underline"":      ['Underline',            'Underline',          'editor_action(this.id)',  '" & Images_ed_format_underline_gif & "'],")
'            mScript.AppendLine("    ""strikethrough"":  ['StrikeThrough',        'Strikethrough',      'editor_action(this.id)',  '" & Images_ed_format_strike_gif & "'],")
'            mScript.AppendLine("    ""subscript"":      ['SubScript',            'Subscript',          'editor_action(this.id)',  '" & Images_ed_format_sub_gif & "'],")
'            mScript.AppendLine("    ""superscript"":    ['SuperScript',          'Superscript',        'editor_action(this.id)',  '" & Images_ed_format_sup_gif & "'],")
'            mScript.AppendLine("    ""justifyleft"":    ['JustifyLeft',          'Justify Left',       'editor_action(this.id)',  '" & Images_ed_align_left_gif & "'],")
'            mScript.AppendLine("    ""justifycenter"":  ['JustifyCenter',        'Justify Center',     'editor_action(this.id)',  '" & Images_ed_align_center_gif & "'],")
'            mScript.AppendLine("    ""justifyright"":   ['JustifyRight',         'Justify Right',      'editor_action(this.id)',  '" & Images_ed_align_right_gif & "'],")
'            mScript.AppendLine("    ""orderedlist"":    ['InsertOrderedList',    'Ordered List',       'editor_action(this.id)',  '" & Images_ed_list_num_gif & "'],")
'            mScript.AppendLine("    ""unorderedlist"":  ['InsertUnorderedList',  'Bulleted List',      'editor_action(this.id)',  '" & Images_ed_list_bullet_gif & "'],")
'            mScript.AppendLine("    ""outdent"":        ['Outdent',              'Decrease Indent',    'editor_action(this.id)',  '" & Images_ed_indent_less_gif & "'],")
'            mScript.AppendLine("    ""indent"":         ['Indent',               'Increase Indent',    'editor_action(this.id)',  '" & Images_ed_indent_more_gif & "'],")
'            mScript.AppendLine("    ""forecolor"":      ['ForeColor',            'Font Color',         'editor_action(this.id)',  '" & Images_ed_color_fg_gif & "'],")
'            mScript.AppendLine("    ""backcolor"":      ['BackColor',            'Background Color',   'editor_action(this.id)',  '" & Images_ed_color_bg_gif & "'],")
'            mScript.AppendLine("    ""horizontalrule"": ['InsertHorizontalRule', 'Horizontal Rule',    'editor_action(this.id)',  '" & Images_ed_hr_gif & "'],")
'            mScript.AppendLine("    ""createlink"":     ['CreateLink',           'Insert Web Link',    'editor_action(this.id)',  '" & Images_ed_link_gif & "'],")
'            mScript.AppendLine(String.Format("    ""insertimage"":    ['InsertImage',          'Insert Image',       ""{0}"",  '" & Images_ed_image_gif & "'],", IIf(String.IsNullOrEmpty(InsertImage_OnClick), "editor_action(this.id)", InsertImage_OnClick)))
'            mScript.AppendLine("    ""inserttable"":    ['InsertTable',          'Insert Table',       'editor_action(this.id)',  '" & Images_insert_table_gif & "'],")
'            mScript.AppendLine("    ""htmlmode"":       ['HtmlMode',             'View HTML Source',   'editor_setmode(\''+objname+'\')', '" & Images_ed_html_gif & "'],")
'            mScript.AppendLine("    ""popupeditor"":    ['popupeditor',          'Enlarge Editor',     'editor_action(this.id)',  '" & Images_fullscreen_maximize_gif & "'],")
'            If mShowAbout Then
'                mScript.AppendLine("    ""about"":          ['about',                'About this editor',  'editor_about(\''+objname+'\')',  '" & Images_ed_about_gif & "'],")
'            End If
'            mScript.AppendLine("")
'            mScript.AppendLine("    ""custom1"":           ['custom1',         'Purpose of button 1',  'editor_action(this.id)',  '" & Images_ed_custom_gif & "'],")
'            mScript.AppendLine("    ""custom2"":           ['custom2',         'Purpose of button 2',  'editor_action(this.id)',  '" & Images_ed_custom_gif & "'],")
'            mScript.AppendLine("    ""custom3"":           ['custom3',         'Purpose of button 3',  'editor_action(this.id)',  '" & Images_ed_custom_gif & "'],")

'            mScript.AppendLine("    ""removehtml"":        ['removehtml',      'Remove HTML Tags',     'editor_action(this.id)',  '" & Images_ed_removehtml_gif & "'],")


'            mScript.AppendLine("    ""help"":           ['showhelp',             'Help using editor',  'editor_action(this.id)',  '" & Images_ed_help_gif & "']};")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_generate(objname,NoToolBar,userConfig) {")
'            mScript.AppendLine("")
'            'mScript.AppendLine(" alert('editor_generate called');  ")
'            mScript.AppendLine("  var config = new editor_defaultConfig(objname);")
'            mScript.AppendLine("  if (userConfig) { ")
'            mScript.AppendLine("    for (var thisName in userConfig) {")
'            mScript.AppendLine("      if (userConfig[thisName]) { config[thisName] = userConfig[thisName]; }")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("  document.all[objname].config = config;                  ")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var obj    = document.all[objname];")
'            mScript.AppendLine("  if (!config.width || config.width == ""auto"") {")
'            mScript.AppendLine("    if      (obj.style.width) { config.width = obj.style.width; }      ")
'            mScript.AppendLine("    else if (obj.cols)        { config.width = (obj.cols * 8) + 22; }  ")
'            mScript.AppendLine("    else                      { config.width = '100%'; }               ")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("  if (!config.height || config.height == ""auto"") {")
'            mScript.AppendLine("    if      (obj.style.height) { config.height = obj.style.height; }   ")
'            mScript.AppendLine("    else if (obj.rows)         { config.height = obj.rows * 17 }       ")
'            mScript.AppendLine("    else                       { config.height = '200'; }              ")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var tblOpen  = '<table border=0 cellspacing=0 cellpadding=0 style=""float: left;""  unselectable=""on""><tr><td style=""border: none; padding: 1 0 0 0""><nobr>';")
'            mScript.AppendLine("  var tblClose = '</nobr></td></tr></table>\n';")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var toolbar = '';")
'            mScript.AppendLine("  var btnGroup, btnItem, aboutEditor;")
'            mScript.AppendLine("  for (var btnGroup in config.toolbar) {")
'            mScript.AppendLine("")
'            mScript.AppendLine("    if (config.toolbar[btnGroup].length == 1 &&")
'            mScript.AppendLine("        config.toolbar[btnGroup][0].toLowerCase() == ""linebreak"") {")
'            mScript.AppendLine("      toolbar += '<br clear=""all"">';")
'            mScript.AppendLine("      continue;")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("")
'            mScript.AppendLine("    toolbar += tblOpen;")
'            mScript.AppendLine("    for (var btnItem in config.toolbar[btnGroup]) {")
'            mScript.AppendLine("      var btnName = config.toolbar[btnGroup][btnItem].toLowerCase();")
'            mScript.AppendLine("")
'            mScript.AppendLine("      if (btnName == ""fontname"") {")
'            mScript.AppendLine("        toolbar += '<select id=""_' +objname+ '_FontName"" onChange=""editor_action(this.id)"" unselectable=""on"" style=""margin: 1 2 0 2; font-size: 12px;"">';")
'            mScript.AppendLine("        for (var fontname in config.fontnames) {")
'            mScript.AppendLine("          toolbar += '<option value=""' +config.fontnames[fontname]+ '"">' +fontname+ '</option>'")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("        toolbar += '</select>';")
'            mScript.AppendLine("        continue;")
'            mScript.AppendLine("      }")
'            mScript.AppendLine("")
'            mScript.AppendLine("      if (btnName == ""fontsize"") {")
'            mScript.AppendLine("        toolbar += '<select id=""_' +objname+ '_FontSize"" onChange=""editor_action(this.id)"" unselectable=""on"" style=""margin: 1 2 0 0; font-size: 12px;"">';")
'            mScript.AppendLine("        for (var fontsize in config.fontsizes) {")
'            mScript.AppendLine("          toolbar += '<option value=""' +config.fontsizes[fontsize]+ '"">' +fontsize+ '</option>'")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("        toolbar += '</select>\n';")
'            mScript.AppendLine("        continue;")
'            mScript.AppendLine("      }")
'            mScript.AppendLine("")
'            mScript.AppendLine("      if (btnName == ""fontstyle"") {")
'            mScript.AppendLine("        toolbar += '<select id=""_' +objname+ '_FontStyle"" onChange=""editor_action(this.id)"" unselectable=""on"" style=""margin: 1 2 0 0; font-size: 12px;"">';")
'            mScript.AppendLine("        + '<option value="""">Font Style</option>';")
'            mScript.AppendLine("        for (var i in config.fontstyles) {")
'            mScript.AppendLine("          var fontstyle = config.fontstyles[i];")
'            mScript.AppendLine("          toolbar += '<option value=""' +fontstyle.className+ '"">' +fontstyle.name+ '</option>'")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("        toolbar += '</select>';")
'            mScript.AppendLine("        continue;")
'            mScript.AppendLine("      }")
'            mScript.AppendLine("")
'            mScript.AppendLine("      if (btnName == ""separator"") {")
'            mScript.AppendLine("        toolbar += '<span style=""border: 1px inset; width: 1px; font-size: 16px; height: 16px; margin: 0 3 0 3""></span>';")
'            mScript.AppendLine("        continue;")
'            mScript.AppendLine("      }")
'            mScript.AppendLine("")

'            'Quotebox option write
'            mScript.AppendLine("if (btnName == ""quotebox"") {")
'            mScript.AppendLine("    toolbar += '<select id=""_' +objname+ '_QuoteBox"" onChange=""editor_action(this.id)"" unselectable=""on"" style=""margin: 1 2 0 0; font-size: 12px;"">';")
'            mScript.AppendLine("    for (var quotebox in config.quoteboxs) {")
'            'mScript.AppendLine("      toolbar += '<option value=\'' +config.quoteboxs[quotebox].replace(/\[DQ\]/g,String.fromCharCode(34))+ '\'>' +quotebox+ '</option>'")
'            mScript.AppendLine("      toolbar += '<option value=""' +config.quoteboxs[quotebox]+ '"">' +quotebox+ '</option>'")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("    toolbar += '</select>\n';")
'            mScript.AppendLine("    continue;")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")

'            mScript.AppendLine("      var btnObj = config.btnList[btnName];")
'            mScript.AppendLine("      if (btnName == 'linebreak') { alert(""htmlArea error: 'linebreak' must be in a subgroup by itself, not with other buttons.\n\nhtmlArea wysiwyg editor not created.""); return; }")
'            mScript.AppendLine("      if (!btnObj) { alert(""htmlArea error: button '"" +btnName+ ""' not found in button list when creating the wysiwyg editor for '""+objname+""'.\nPlease make sure you entered the button name correctly.\n\nhtmlArea wysiwyg editor not created.""); return; }")
'            mScript.AppendLine("      var btnCmdID   = btnObj[0];")
'            mScript.AppendLine("      var btnTitle   = btnObj[1];")
'            mScript.AppendLine("      var btnOnClick = btnObj[2];")
'            mScript.AppendLine("      var btnImage   = btnObj[3];")
'            mScript.AppendLine("      toolbar += '<button title=""' +btnTitle+ '"" id=""_' +objname+ '_' +btnCmdID+ '"" class=""btn"" onClick=""' +btnOnClick+ '"" onmouseover=""if(this.className==\'btn\'){this.className=\'btnOver\'}"" onmouseout=""if(this.className==\'btnOver\'){this.className=\'btn\'}"" unselectable=""on""><img src=""' +config.imgURL + btnImage+ '"" border=0 unselectable=""on""></button>';")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("    } ")
'            mScript.AppendLine("    toolbar += tblClose;")
'            mScript.AppendLine("  } ")
'            mScript.AppendLine("")

'            mScript.AppendLine("  var editor = '<span id=""_editor_toolbar""><table border=0 cellspacing=0 cellpadding=0 bgcolor=""buttonface"" style=""padding: 1 0 0 2"" width=' + config.width + ' unselectable=""on""><tr><td>\n';")
'            mScript.AppendLine("  if (NoToolBar) {")
'            mScript.AppendLine("    editor+= '';")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("  else {")
'            mScript.AppendLine("    editor+= toolbar;")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("  editor+= '</td></tr></table>\n'")
'            mScript.AppendLine("  + '</td></tr></table></span>\n'")
'            mScript.AppendLine("  + '<textarea ID=""_' +objname + '_editor"" style=""width:' +config.width+ '; height:' +config.height+ '; margin-top: -1px; margin-bottom: -1px;"" wrap=soft></textarea>';")

'            'mScript.AppendLine("  var editor = '<span id=""_editor_toolbar""><table border=0 cellspacing=0 cellpadding=0 bgcolor=""buttonface"" style=""padding: 1 0 0 2"" width=' + config.width + ' unselectable=""on""><tr><td>\n'")
'            'mScript.AppendLine("  + toolbar")
'            'mScript.AppendLine("  + '</td></tr></table>\n'")
'            'mScript.AppendLine("  + '</td></tr></table></span>\n'")
'            'mScript.AppendLine("  + '<textarea ID=""_' +objname + '_editor"" style=""width:' +config.width+ '; height:' +config.height+ '; margin-top: -1px; margin-bottom: -1px;"" wrap=soft></textarea>';")

'            mScript.AppendLine("")
'            mScript.AppendLine("  editor += '<div id=""_' +objname + '_cMenu"" style=""position: absolute; visibility: hidden;""></div>';")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (!config.debug) { document.all[objname].style.display = ""none""; }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (config.plaintextInput) {     ")
'            mScript.AppendLine("    var contents = document.all[objname].value;")
'            mScript.AppendLine("    contents = contents.replace(/\r\n/g, '<br>');")
'            mScript.AppendLine("    contents = contents.replace(/\n/g, '<br>');")
'            mScript.AppendLine("    contents = contents.replace(/\r/g, '<br>');")
'            mScript.AppendLine("    document.all[objname].value = contents;")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  document.all[objname].insertAdjacentHTML('afterEnd', editor)")
'            mScript.AppendLine("")
'            mScript.AppendLine("  editor_setmode(objname, 'init');")
'            mScript.AppendLine("")
'            mScript.AppendLine("  for (var idx=0; idx < document.forms.length; idx++) {")
'            mScript.AppendLine("    var r = document.forms[idx].attachEvent('onsubmit', function() { editor_filterOutput(objname); });")
'            mScript.AppendLine("    if (!r) { alert(""Error attaching event to form!""); }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("return true;")
'            mScript.AppendLine("")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_action(button_id) {")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var BtnParts = Array();")
'            mScript.AppendLine("  BtnParts = button_id.split(""_"");")
'            mScript.AppendLine("  var objname    = button_id.replace(/^_(.*)_[^_]*$/, '$1');")
'            mScript.AppendLine("  var cmdID      = BtnParts[ BtnParts.length-1 ];")
'            mScript.AppendLine("  var button_obj = document.all[button_id];")
'            mScript.AppendLine("  var editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.AppendLine("  var config     = document.all[objname].config;")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (cmdID == 'showhelp') {")
'            mScript.AppendLine("    window.open(_editor_url + """ & Popup_editor_help_html & """, 'EditorHelp');")
'            mScript.AppendLine("    return;")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            If Not NoPopupEditor Then

'                mScript.AppendLine("  if (cmdID == 'popupeditor') {")

'                For cnt As Integer = 0 To mScr2.Count - 1
'                    mScript.AppendLine("    mBigScript[" & cnt + 1 & "] = """ & mScr2(cnt) & """")
'                Next
'                mScript.AppendLine("    bigwin = window.open('','FullScreen','toolbar=no,location=no,directories=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,width=645,height=480')")
'                mScript.AppendLine("    for(cnt=1;cnt<mBigScript.length;cnt++) {")
'                mScript.AppendLine("        if(cnt==5) {") '[Org] will change here
'                mScript.AppendLine("            bigwin.document.writeln('ParentTextAreaName=\''+objname+'\';')")
'                mScript.AppendLine("        }")
'                mScript.AppendLine("        else {")
'                mScript.AppendLine("            bigwin.document.writeln(mBigScript[cnt]);")
'                mScript.AppendLine("        }")
'                mScript.AppendLine("    }")


'                mScript.AppendLine("    bigwin.location.reload()")


'                mScript.AppendLine("    return;")
'                mScript.AppendLine("  }")
'                mScript.AppendLine("")
'            End If
'            mScript.AppendLine("  if (editor_obj.tagName.toLowerCase() == 'textarea') { return; }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var editdoc = editor_obj.contentWindow.document;")
'            mScript.AppendLine("  editor_focus(editor_obj);")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var idx = button_obj.selectedIndex;")
'            mScript.AppendLine("  var val = (idx != null) ? button_obj[ idx ].value : null;")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (0) {}   ")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("  else if (cmdID == 'custom1') {")
'            mScript.AppendLine("    alert(""Hello, I am custom button 1!"");")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  else if (cmdID == 'custom2') {  ")
'            mScript.AppendLine("    var myTitle = ""This is a custom title"";")
'            mScript.AppendLine("    var myText = showModalDialog(_editor_url + """ & Popup_custom2_html & """,")
'            mScript.AppendLine("                                 myTitle,      ")
'            mScript.AppendLine("                                 ""resizable: yes; help: no; status: no; scroll: no; "");")
'            mScript.AppendLine("    if (myText) { editor_insertHTML(objname, myText); }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  else if (cmdID == 'custom3') {  ")
'            mScript.AppendLine("    editor_insertHTML(objname, ""It's easy to add buttons that insert text!"");")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")

'            mScript.AppendLine("else if (cmdID == 'removehtml') {")

'            'RemoveHTMLTags Server side postback
'            'mScript.AppendLine("    ___doPostBack(objname,'RemoveHtmlTags()');")

'            'RemoveHTMLTags ClientSide
'            'mScript.AppendLine("    editor_updateToolbar(objname,'disable');")
'            mScript.AppendLine("    editor_setHTML(objname,RemoveHtmlTags(document.all[objname].value));")
'            'mScript.AppendLine("    editor_updateToolbar(objname,'enable');")
'            mScript.AppendLine("}")

'            'Quotebox onselect Action
'            mScript.AppendLine("else if (cmdID == 'QuoteBox') {")
'            mScript.AppendLine("    button_obj.selectedIndex=0;")
'            mScript.AppendLine("    var mValArakkal = val;")
'            mScript.AppendLine("    mValArakkal = mValArakkal.replace(/\[DQ\]/g,String.fromCharCode(34));")
'            mScript.AppendLine("    mValArakkal = mValArakkal.replace(/\[SQ\]/g,String.fromCharCode(39));")
'            mScript.AppendLine("    editor_insertHTML(objname,mValArakkal);")
'            mScript.AppendLine("}")

'            mScript.AppendLine("")
'            mScript.AppendLine("  else if (cmdID == 'FontName' && val) {")
'            mScript.AppendLine("    editdoc.execCommand(cmdID,0,val);")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  else if (cmdID == 'FontSize' && val) {")
'            mScript.AppendLine("    editdoc.execCommand(cmdID,0,val);")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  else if (cmdID == 'FontStyle' && val) {")
'            mScript.AppendLine("    editdoc.execCommand('RemoveFormat');")
'            mScript.AppendLine("    editdoc.execCommand('FontName',0,'636c6173734e616d6520706c616365686f6c646572');")
'            mScript.AppendLine("    var fontArray = editdoc.all.tags(""FONT"");")
'            mScript.AppendLine("    for (i=0; i<fontArray.length; i++) {")
'            mScript.AppendLine("      if (fontArray[i].face == '636c6173734e616d6520706c616365686f6c646572') {")
'            mScript.AppendLine("        fontArray[i].face = """";")
'            mScript.AppendLine("        fontArray[i].className = val;")
'            mScript.AppendLine("        fontArray[i].outerHTML = fontArray[i].outerHTML.replace(/face=['""]+/, """");")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("    button_obj.selectedIndex =0;")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  else if (cmdID == 'ForeColor' || cmdID == 'BackColor') {")
'            mScript.AppendLine("    var oldcolor = _dec_to_rgb(editdoc.queryCommandValue(cmdID));")
'            mScript.AppendLine("    var newcolor = showModalDialog(_editor_url + """ & Popup_select_color_html & """, oldcolor, ""resizable: no; help: no; status: no; scroll: no;"");")
'            mScript.AppendLine("    if (newcolor != null) { editdoc.execCommand(cmdID, false, ""#""+newcolor); }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  else {")
'            mScript.AppendLine("    if (cmdID.toLowerCase() == 'subscript' && editdoc.queryCommandState('superscript')) { editdoc.execCommand('superscript'); }")
'            mScript.AppendLine("    if (cmdID.toLowerCase() == 'superscript' && editdoc.queryCommandState('subscript')) { editdoc.execCommand('subscript'); }")
'            mScript.AppendLine("")
'            mScript.AppendLine("    if (cmdID.toLowerCase() == 'createlink'){")
'            mScript.AppendLine("      editdoc.execCommand(cmdID,1);")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("")
'            mScript.AppendLine("    else if (cmdID.toLowerCase() == 'insertimage'){")
'            mScript.AppendLine("      showModalDialog(_editor_url + """ & Popup_insert_image_html & """, editdoc, ""resizable: no; help: no; status: no; scroll: no; "");")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("")
'            mScript.AppendLine("    else if (cmdID.toLowerCase() == 'inserttable'){")
'            'mScript.AppendLine("      alert(_editor_url + """ & Popup_insert_table_html & "?""+objname)")

'            mScript.AppendLine("      showModalDialog(_editor_url + """ & Popup_insert_table_html & "?""+objname,")
'            mScript.AppendLine("                                 window,")
'            mScript.AppendLine("                                 ""resizable: yes; help: no; status: no; scroll: no; "");")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("")
'            mScript.AppendLine("    else { editdoc.execCommand(cmdID); }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  editor_event(objname);")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")

'            'CHARECTOR COUNT FUNCTION
'            mScript.AppendLine("function editor_onLengthChanged(ArfObj) {")
'            mScript.AppendLine("    var ARFchars = 0;")
'            mScript.AppendLine("    var ARFwords = 0;")
'            mScript.AppendLine("    var ARFdummy = '';")
'            mScript.AppendLine("    ARFdummy = editor_getHTML(ArfObj);")
'            mScript.AppendLine("    ARFchars = ARFdummy.length;")
'            'mScript.AppendLine("    ARFwords = GetWordCount(ARFdummy);")
'            mScript.AppendLine("    eval(ArfObj+'_ST('+ARFchars+','+ARFwords+');');")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")

'            'CHARCOUNT FUNCTION CALL
'            mScript.AppendLine("function editor_event(objname,runDelay) {")
'            'mScript.AppendLine("  editor_onLengthChanged(objname);")
'            mScript.AppendLine("  var config = document.all[objname].config;")
'            mScript.AppendLine("  var editor_obj  = document.all[""_"" +objname+  ""_editor""];       ")
'            mScript.AppendLine("  if (runDelay == null) { runDelay = 0; }")
'            mScript.AppendLine("  var editdoc;")
'            mScript.AppendLine("  var editEvent = editor_obj.contentWindow ? editor_obj.contentWindow.event : event;")
'            mScript.AppendLine("")
'            mScript.AppendLine("    if (editEvent && editEvent.keyCode) {")
'            mScript.AppendLine("      var ord       = editEvent.keyCode;    ")
'            mScript.AppendLine("      var ctrlKey   = editEvent.ctrlKey;")
'            mScript.AppendLine("      var altKey    = editEvent.altKey;")
'            mScript.AppendLine("      var shiftKey  = editEvent.shiftKey;")
'            mScript.AppendLine("")
'            mScript.AppendLine("      if (ord == 16) { return; }  ")
'            mScript.AppendLine("      if (ord == 17) { return; }  ")
'            mScript.AppendLine("      if (ord == 18) { return; }  ")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("      if (ctrlKey && (ord == 122 || ord == 90)) {     ")
'            mScript.AppendLine("        return;")
'            mScript.AppendLine("      }")
'            mScript.AppendLine("      if ((ctrlKey && (ord == 121 || ord == 89)) ||")
'            mScript.AppendLine("          ctrlKey && shiftKey && (ord == 122 || ord == 90)) {     ")
'            mScript.AppendLine("        return;")
'            mScript.AppendLine("      }")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (runDelay > 0) { return setTimeout(function(){ editor_event(objname); }, runDelay); }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (this.tooSoon == 1 && runDelay >= 0) { this.queue = 1; return; } ")
'            mScript.AppendLine("  this.tooSoon = 1;")
'            mScript.AppendLine("  setTimeout(function(){")
'            mScript.AppendLine("    this.tooSoon = 0;")
'            mScript.AppendLine("    if (this.queue) { editor_event(objname,-1); };")
'            mScript.AppendLine("    this.queue = 0;")
'            mScript.AppendLine("    }, 333);  ")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("  editor_updateOutput(objname);")
'            mScript.AppendLine("  editor_updateToolbar(objname);")

'            mScript.AppendLine("  editor_onLengthChanged(objname);")

'            mScript.AppendLine("")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_updateToolbar(objname,action) {")
'            mScript.AppendLine("  var config = document.all[objname].config;")
'            mScript.AppendLine("  var editor_obj  = document.all[""_"" +objname+  ""_editor""];")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (action == ""enable"" || action == ""disable"") {")
'            mScript.AppendLine("    var tbItems = new Array('FontName','FontSize','FontStyle');                           ")
'            mScript.AppendLine("    for (var btnName in config.btnList) { tbItems.push(config.btnList[btnName][0]); } ")
'            mScript.AppendLine("")
'            mScript.AppendLine("    for (var idxN in tbItems) {")
'            mScript.AppendLine("      var cmdID = tbItems[idxN].toLowerCase();")
'            mScript.AppendLine("      var tbObj = document.all[""_"" +objname+ ""_"" +tbItems[idxN]];")
'            mScript.AppendLine("      if (cmdID == ""htmlmode"" || cmdID == ""about"" || cmdID == ""showhelp"" || cmdID == ""popupeditor"") { continue; } ")
'            mScript.AppendLine("      if (tbObj == null) { continue; }")
'            mScript.AppendLine("      var isBtn = (tbObj.tagName.toLowerCase() == ""button"") ? true : false;")
'            mScript.AppendLine("")
'            mScript.AppendLine("      if (action == ""enable"")  { tbObj.disabled = false; if (isBtn) { tbObj.className = 'btn' }}")
'            mScript.AppendLine("      if (action == ""disable"") { tbObj.disabled = true;  if (isBtn) { tbObj.className = 'btnNA' }}")
'            mScript.AppendLine("    }")

'            mScript.AppendLine("    var tbItems2 = new Array('QuoteBox');")
'            mScript.AppendLine("    for (var idxN2 in tbItems2) {")
'            mScript.AppendLine("        var tbObj2 = document.all[""_"" +objname+ ""_"" +tbItems2[idxN2]];")
'            mScript.AppendLine("        if (tbObj2 == null) { continue; }")
'            mScript.AppendLine("        if (action == ""enable"")  { tbObj2.disabled = false; }")
'            mScript.AppendLine("        if (action == ""disable"") { tbObj2.disabled = true;  }")
'            mScript.AppendLine("    }")

'            mScript.AppendLine("    return;")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (editor_obj.tagName.toLowerCase() == 'textarea') { return; }   ")
'            mScript.AppendLine("  var editdoc = editor_obj.contentWindow.document;")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var fontname_obj = document.all[""_"" +objname+ ""_FontName""];")
'            mScript.AppendLine("  if (fontname_obj) {")
'            mScript.AppendLine("    var fontname = editdoc.queryCommandValue('FontName');")
'            mScript.AppendLine("    if (fontname == null) { fontname_obj.value = null; }")
'            mScript.AppendLine("    else {")
'            mScript.AppendLine("      var found = 0;")
'            mScript.AppendLine("      for (i=0; i<fontname_obj.length; i++) {")
'            mScript.AppendLine("        if (fontname.toLowerCase() == fontname_obj[i].text.toLowerCase()) {")
'            mScript.AppendLine("          fontname_obj.selectedIndex = i;")
'            mScript.AppendLine("          found = 1;")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("      }")
'            mScript.AppendLine("      if (found != 1) { fontname_obj.value = null; }     ")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var fontsize_obj = document.all[""_"" +objname+ ""_FontSize""];")
'            mScript.AppendLine("  if (fontsize_obj) {")
'            mScript.AppendLine("    var fontsize = editdoc.queryCommandValue('FontSize');")
'            mScript.AppendLine("    if (fontsize == null) { fontsize_obj.value = null; }")
'            mScript.AppendLine("    else {")
'            mScript.AppendLine("      var found = 0;")
'            mScript.AppendLine("      for (i=0; i<fontsize_obj.length; i++) {")
'            mScript.AppendLine("        if (fontsize == fontsize_obj[i].value) { fontsize_obj.selectedIndex = i; found=1; }")
'            mScript.AppendLine("      }")
'            mScript.AppendLine("      if (found != 1) { fontsize_obj.value = null; }    ")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var classname_obj = document.all[""_"" +objname+ ""_FontStyle""];")
'            mScript.AppendLine("  if (classname_obj) {")
'            mScript.AppendLine("    var curRange = editdoc.selection.createRange();")
'            mScript.AppendLine("")
'            mScript.AppendLine("    var pElement;")
'            mScript.AppendLine("    if (curRange.length) { pElement = curRange[0]; }              ")
'            mScript.AppendLine("    else                 { pElement = curRange.parentElement(); } ")
'            mScript.AppendLine("    while (pElement && !pElement.className) { pElement = pElement.parentElement; }  ")
'            mScript.AppendLine("")
'            mScript.AppendLine("    var thisClass = pElement ? pElement.className.toLowerCase() : """";")
'            mScript.AppendLine("    if (!thisClass && classname_obj.value) { classname_obj.value = null; }")
'            mScript.AppendLine("    else {")
'            mScript.AppendLine("      var found = 0;")
'            mScript.AppendLine("      for (i=0; i<classname_obj.length; i++) {")
'            mScript.AppendLine("        if (thisClass == classname_obj[i].value.toLowerCase()) {")
'            mScript.AppendLine("          classname_obj.selectedIndex = i;")
'            mScript.AppendLine("          found=1;")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("      }")
'            mScript.AppendLine("      if (found != 1) { classname_obj.value = null; }     ")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var IDList = Array('Bold','Italic','Underline','StrikeThrough','SubScript','SuperScript','JustifyLeft','JustifyCenter','JustifyRight','InsertOrderedList','InsertUnorderedList');")
'            mScript.AppendLine("  for (i=0; i<IDList.length; i++) {")
'            mScript.AppendLine("    var btnObj = document.all[""_"" +objname+ ""_"" +IDList[i]];")
'            mScript.AppendLine("    if (btnObj == null) { continue; }")
'            mScript.AppendLine("    var cmdActive = editdoc.queryCommandState( IDList[i] );")
'            mScript.AppendLine("")
'            mScript.AppendLine("    if (!cmdActive)  {                                  ")
'            mScript.AppendLine("      if (btnObj.className != 'btn') { btnObj.className = 'btn'; }")
'            mScript.AppendLine("      if (btnObj.disabled  != false) { btnObj.disabled = false; }")
'            mScript.AppendLine("    } else if (cmdActive)  {                            ")
'            mScript.AppendLine("      if (btnObj.className != 'btnDown') { btnObj.className = 'btnDown'; }")
'            mScript.AppendLine("      if (btnObj.disabled  != false)   { btnObj.disabled = false; }")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_updateOutput(objname) {")
'            mScript.AppendLine("  var config     = document.all[objname].config;")
'            mScript.AppendLine("  var editor_obj  = document.all[""_"" +objname+  ""_editor""];       ")
'            mScript.AppendLine("  var editEvent = editor_obj.contentWindow ? editor_obj.contentWindow.event : event;")
'            mScript.AppendLine("  var isTextarea = (editor_obj.tagName.toLowerCase() == 'textarea');")
'            mScript.AppendLine("  var editdoc = isTextarea ? null : editor_obj.contentWindow.document;")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var contents;")
'            mScript.AppendLine("  if (isTextarea) { contents = editor_obj.value; }")
'            mScript.AppendLine("  else            { contents = editdoc.body.innerHTML; }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (config.lastUpdateOutput && config.lastUpdateOutput == contents) { return; }")
'            mScript.AppendLine("  else { config.lastUpdateOutput = contents; }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  document.all[objname].value = contents;")
'            mScript.AppendLine("")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_filterOutput(objname) {")
'            mScript.AppendLine("  editor_updateOutput(objname);")
'            mScript.AppendLine("  var contents = document.all[objname].value;")
'            mScript.AppendLine("  var config   = document.all[objname].config;")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (contents.toLowerCase() == '<p>&nbsp;</p>') { contents = """"; }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var filterTag = function(tagBody,tagName,tagAttr) {")
'            mScript.AppendLine("    tagName = tagName.toLowerCase();")
'            mScript.AppendLine("    var closingTag = (tagBody.match(/^<\//)) ? true : false;")
'            mScript.AppendLine("")
'            mScript.AppendLine("    if (tagName == 'img') { tagBody = tagBody.replace(/(src\s*=\s*.)[^*]*(\*\*\*)/, ""$1$2""); }")
'            mScript.AppendLine("    if (tagName == 'a')   { tagBody = tagBody.replace(/(href\s*=\s*.)[^*]*(\*\*\*)/, ""$1$2""); }")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("    return tagBody;")
'            mScript.AppendLine("  };")
'            mScript.AppendLine("")
'            mScript.AppendLine("  RegExp.lastIndex = 0;")
'            mScript.AppendLine("    var matchTag = /<\/?(\w+)((?:[^'"">]*|'[^']*'|""[^""]*"")*)>/g;   ")
'            mScript.AppendLine("")
'            mScript.AppendLine("  contents = contents.replace(matchTag, filterTag);")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (config.replaceNextlines) { ")
'            mScript.AppendLine("    contents = contents.replace(/\r\n/g, ' ');")
'            mScript.AppendLine("    contents = contents.replace(/\n/g, ' ');")
'            mScript.AppendLine("    contents = contents.replace(/\r/g, ' ');")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  document.all[objname].value = contents;")
'            mScript.AppendLine("")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_setmode(objname, mode) {")
'            mScript.AppendLine("  var config     = document.all[objname].config;")
'            mScript.AppendLine("  var editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (document.readyState != 'complete') {")
'            mScript.AppendLine("    setTimeout(function() { editor_setmode(objname,mode) }, 25);")
'            mScript.AppendLine("    return;")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var TextEdit   = '<textarea ID=""_' +objname + '_editor"" style=""width:' +editor_obj.style.width+ '; height:' +editor_obj.style.height+ '; margin-top: -1px; margin-bottom: -1px;""></textarea>';")
'            mScript.AppendLine("  var RichEdit   = '<iframe ID=""_' +objname+ '_editor""    style=""width:' +editor_obj.style.width+ '; height:' +editor_obj.style.height+ ';""></iframe>';")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (mode == ""textedit"" || editor_obj.tagName.toLowerCase() == 'iframe') {")
'            mScript.AppendLine("    config.mode = ""textedit"";")
'            mScript.AppendLine("    var editdoc = editor_obj.contentWindow.document;")
'            mScript.AppendLine("    var contents = editdoc.body.createTextRange().htmlText;")
'            mScript.AppendLine("    editor_obj.outerHTML = TextEdit;")
'            mScript.AppendLine("    editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.AppendLine("    editor_obj.value = contents;")
'            mScript.AppendLine("    editor_event(objname);")
'            mScript.AppendLine("")
'            mScript.AppendLine("    editor_updateToolbar(objname, ""disable"");  ")
'            mScript.AppendLine("")

'            'HTMLAREA EVENTS
'            'mScript.AppendLine("    editor_obj.onpropertychange = function() { editor_onpropertychange(objname); }")
'            'mScript.AppendLine("    editor_obj.onselect         = function() { editor_onselect(objname); }")
'            'mScript.AppendLine("    editor_obj.onclick          = function() { editor_onclick(objname); }")

'            mScript.AppendLine("    editor_obj.onkeydown        = function() { editor_event(objname); }")
'            mScript.AppendLine("    editor_obj.onkeypress       = function() { editor_event(objname); }")
'            mScript.AppendLine("    editor_obj.onkeyup          = function() { editor_event(objname); }")
'            mScript.AppendLine("    editor_obj.onmouseup        = function() { editor_event(objname); }")
'            mScript.AppendLine("    editor_obj.ondrop           = function() { editor_event(objname, 100); }     ")
'            mScript.AppendLine("    editor_obj.oncut            = function() { editor_event(objname, 100); }")
'            mScript.AppendLine("    editor_obj.onpaste          = function() { editor_event(objname, 100); }")
'            mScript.AppendLine("    editor_obj.onblur           = function() { editor_event(objname, -1); }")
'            mScript.AppendLine("")
'            mScript.AppendLine("    editor_updateOutput(objname);")
'            mScript.AppendLine("    editor_focus(editor_obj);")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("  else {")
'            mScript.AppendLine("    config.mode = ""wysiwyg"";")
'            mScript.AppendLine("    var contents = editor_obj.value;")
'            mScript.AppendLine("    if (mode == 'init') { contents = document.all[objname].value; } ")
'            mScript.AppendLine("")
'            mScript.AppendLine("    editor_obj.outerHTML = RichEdit;")
'            mScript.AppendLine("    editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("    var html = """";")
'            mScript.AppendLine("    html += '<html><head>\n';")
'            mScript.AppendLine("    if (config.stylesheet) {")
'            mScript.AppendLine("      html += '<link href=""' +config.stylesheet+ '"" rel=""stylesheet"" type=""text/css"">\n';")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("    html += '<style>\n';")
'            mScript.AppendLine("    html += 'body {' +config.bodyStyle+ '} \n';")
'            mScript.AppendLine("    for (var i in config.fontstyles) {")
'            mScript.AppendLine("      var fontstyle = config.fontstyles[i];")
'            mScript.AppendLine("      if (fontstyle.classStyle) {")
'            mScript.AppendLine("        html += '.' +fontstyle.className+ ' {' +fontstyle.classStyle+ '}\n';")
'            mScript.AppendLine("      }")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("    html += '</style>\n'")
'            mScript.AppendLine("      + '</head>\n'")
'            mScript.AppendLine("      + '<body contenteditable=""true"" topmargin=1 leftmargin=1'")
'            mScript.AppendLine("")
'            mScript.AppendLine("      +'>'")
'            mScript.AppendLine("      + contents")
'            mScript.AppendLine("      + '</body>\n'")
'            mScript.AppendLine("      + '</html>\n';")
'            mScript.AppendLine("")
'            mScript.AppendLine("    var editdoc = editor_obj.contentWindow.document;")
'            mScript.AppendLine("")
'            mScript.AppendLine("    editdoc.open();")
'            mScript.AppendLine("    editdoc.write(html);")
'            mScript.AppendLine("    editdoc.close();")
'            mScript.AppendLine("")
'            mScript.AppendLine("    editor_updateToolbar(objname, ""enable"");  ")
'            mScript.AppendLine("")
'            mScript.AppendLine("    editdoc.objname = objname;")
'            mScript.AppendLine("")

'            mScript.AppendLine("    editdoc.onkeydown           = function() { editor_event(objname); }")
'            mScript.AppendLine("    editdoc.onkeypress          = function() { editor_event(objname); }")
'            mScript.AppendLine("    editdoc.onkeyup             = function() { editor_event(objname); }")
'            mScript.AppendLine("    editdoc.onmouseup           = function() { editor_event(objname); }")
'            mScript.AppendLine("    editdoc.body.ondrop         = function() { editor_event(objname, 100); }     ")
'            mScript.AppendLine("    editdoc.body.oncut          = function() { editor_event(objname, 100); }")
'            mScript.AppendLine("    editdoc.body.onpaste        = function() { editor_event(objname, 100); }")
'            mScript.AppendLine("    editdoc.body.onblur         = function() { editor_event(objname, -1); }")
'            mScript.AppendLine("")
'            mScript.AppendLine("    if (mode != 'init') {             ")
'            mScript.AppendLine("      editor_focus(editor_obj);")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (mode != 'init') {             ")
'            mScript.AppendLine("    editor_event(objname);")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_focus(editor_obj) {")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (editor_obj.tagName.toLowerCase() == 'textarea') {         ")
'            mScript.AppendLine("    var myfunc = function() { editor_obj.focus(); };")
'            mScript.AppendLine("    setTimeout(myfunc,100);                                     ")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  else {                                                        ")
'            mScript.AppendLine("    var editdoc = editor_obj.contentWindow.document;           ")
'            mScript.AppendLine("    var editorRange = editdoc.body.createTextRange();           ")
'            mScript.AppendLine("    var curRange    = editdoc.selection.createRange();          ")
'            mScript.AppendLine("")
'            mScript.AppendLine("    if (curRange.length == null &&                              ")
'            mScript.AppendLine("        !editorRange.inRange(curRange)) {                       ")
'            mScript.AppendLine("      editorRange.collapse();                                   ")
'            mScript.AppendLine("      editorRange.select();                                     ")
'            mScript.AppendLine("      curRange = editorRange;")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_about(objname) {")
'            mScript.AppendLine("  showModalDialog(_editor_url + """ & Popup_about_html & """, window, ""resizable: yes; help: no; status: no; scroll: no; "");")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function _dec_to_rgb(value) {")
'            mScript.AppendLine("  var hex_string = """";")
'            mScript.AppendLine("  for (var hexpair = 0; hexpair < 3; hexpair++) {")
'            mScript.AppendLine("    var myByte = value & 0xFF;            ")
'            mScript.AppendLine("    value >>= 8;                        ")
'            mScript.AppendLine("    var nybble2 = myByte & 0x0F;          ")
'            mScript.AppendLine("    var nybble1 = (myByte >> 4) & 0x0F;   ")
'            mScript.AppendLine("    hex_string += nybble1.toString(16); ")
'            mScript.AppendLine("    hex_string += nybble2.toString(16); ")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("  return hex_string.toUpperCase();")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_insertHTML(objname, str1,str2, reqSel) {")
'            mScript.AppendLine("  var config     = document.all[objname].config;")
'            mScript.AppendLine("  var editor_obj = document.all[""_"" +objname + ""_editor""];    ")
'            mScript.AppendLine("  if (str1 == null) { str1 = ''; }")
'            mScript.AppendLine("  if (str2 == null) { str2 = ''; }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (document.all[objname] && editor_obj == null) {")
'            mScript.AppendLine("    document.all[objname].focus();")
'            mScript.AppendLine("    document.all[objname].value = document.all[objname].value + str1 + str2;")
'            mScript.AppendLine("    return;")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (editor_obj == null) { return alert(""Unable to insert HTML.  Invalid object name '"" +objname+ ""'.""); }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  editor_focus(editor_obj);")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var tagname = editor_obj.tagName.toLowerCase();")
'            mScript.AppendLine("  var sRange;")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (tagname == 'iframe') {")
'            mScript.AppendLine("    var editdoc = editor_obj.contentWindow.document;")
'            mScript.AppendLine("    sRange  = editdoc.selection.createRange();")
'            mScript.AppendLine("    var sHtml   = sRange.htmlText;")
'            mScript.AppendLine("")
'            mScript.AppendLine("    if (sRange.length) { return alert(""Unable to insert HTML.  Try highlighting content instead of selecting it.""); }")
'            mScript.AppendLine("")
'            mScript.AppendLine("    var oldHandler = window.onerror;")
'            mScript.AppendLine("    window.onerror = function() { alert(""Unable to insert HTML for current selection.""); return true; } ")
'            mScript.AppendLine("    if (sHtml.length) {                                 ")
'            mScript.AppendLine("      if (str2) { sRange.pasteHTML(str1 +sHtml+ str2) } ")
'            mScript.AppendLine("      else      { sRange.pasteHTML(str1); }             ")
'            mScript.AppendLine("    } else {                                            ")
'            mScript.AppendLine("      if (reqSel) { return alert(""Unable to insert HTML.  You must select something first.""); }")
'            mScript.AppendLine("      sRange.pasteHTML(str1 + str2);                    ")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("    window.onerror = oldHandler;")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  else if (tagname == 'textarea') {")
'            mScript.AppendLine("    editor_obj.focus();")
'            mScript.AppendLine("    sRange  = document.selection.createRange();")
'            mScript.AppendLine("    var sText   = sRange.text;")
'            mScript.AppendLine("")
'            mScript.AppendLine("    if (sText.length) {                                 ")
'            mScript.AppendLine("      if (str2) { sRange.text = str1 +sText+ str2; }  ")
'            mScript.AppendLine("      else      { sRange.text = str1; }               ")
'            mScript.AppendLine("    } else {                                            ")
'            mScript.AppendLine("      if (reqSel) { return alert(""Unable to insert HTML.  You must select something first.""); }")
'            mScript.AppendLine("      sRange.text = str1 + str2;                        ")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("  else { alert(""Unable to insert HTML.  Unknown object tag type '"" +tagname+ ""'.""); }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  sRange.collapse(false); ")
'            mScript.AppendLine("  sRange.select();        ")
'            mScript.AppendLine("")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_getHTML(objname) {")
'            mScript.AppendLine("  var editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.AppendLine("  var isTextarea = (editor_obj.tagName.toLowerCase() == 'textarea');")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (isTextarea) { return editor_obj.value; }")
'            mScript.AppendLine("  else            { return editor_obj.contentWindow.document.body.innerHTML; }")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_setHTML(objname, html) {")
'            mScript.AppendLine("  var editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.AppendLine("  var isTextarea = (editor_obj.tagName.toLowerCase() == 'textarea');")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (isTextarea) { editor_obj.value = html; }")
'            mScript.AppendLine("  else            { editor_obj.contentWindow.document.body.innerHTML = html; }")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_appendHTML(objname, html) {")
'            mScript.AppendLine("  var editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.AppendLine("  var isTextarea = (editor_obj.tagName.toLowerCase() == 'textarea');")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (isTextarea) { editor_obj.value += html; }")
'            mScript.AppendLine("  else            { editor_obj.contentWindow.document.body.innerHTML += html; }")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function _isMouseOver(obj,event) {       ")
'            mScript.AppendLine("  var mouseX    = event.clientX;")
'            mScript.AppendLine("  var mouseY    = event.clientY;")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var objTop    = obj.offsetTop;")
'            mScript.AppendLine("  var objBottom = obj.offsetTop + obj.offsetHeight;")
'            mScript.AppendLine("  var objLeft   = obj.offsetLeft;")
'            mScript.AppendLine("  var objRight  = obj.offsetLeft + obj.offsetWidth;")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (mouseX >= objLeft && mouseX <= objRight &&")
'            mScript.AppendLine("      mouseY >= objTop  && mouseY <= objBottom) { return true; }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  return false;")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_cMenu_generate(editorWin,objname) {")
'            mScript.AppendLine("  var parentWin = window;")
'            mScript.AppendLine("  editorWin.event.returnValue = false;  ")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var cMenuOptions = [ ")
'            mScript.AppendLine("    ['Cut', 'Ctrl-X', function() {}],")
'            mScript.AppendLine("    ['Copy', 'Ctrl-C', function() {}],")
'            mScript.AppendLine("    ['Paste', 'Ctrl-C', function() {}],")
'            mScript.AppendLine("    ['Delete', 'DEL', function() {}],")
'            mScript.AppendLine("    ['---', null, null],")
'            mScript.AppendLine("    ['Select All', 'Ctrl-A', function() {}],")
'            mScript.AppendLine("    ['Clear All', '', function() {}],")
'            mScript.AppendLine("    ['---', null, null],")
'            mScript.AppendLine("    ['About this editor...', '', function() {")
'            mScript.AppendLine("      alert(""about this editor"");")
'            mScript.AppendLine("    }]];")
'            mScript.AppendLine("    editor_cMenu.options = cMenuOptions; ")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var cMenuHeader = ''")
'            mScript.AppendLine("    + '<div id=""_'+objname+'_cMenu"" onblur=""editor_cMenu(this);"" oncontextmenu=""return false;"" onselectstart=""return false""'")
'            mScript.AppendLine("    + '  style=""position: absolute; visibility: hidden; cursor: default; width: 167px; background-color: threedface;'")
'            mScript.AppendLine("    + '         border: solid 1px; border-color: threedlightshadow threeddarkshadow threeddarkshadow threedlightshadow;"">'")
'            mScript.AppendLine("    + '<table border=0 cellspacing=0 cellpadding=0 width=""100%"" style=""width: 167px; background-color: threedface; border: solid 1px; border-color: threedhighlight threedshadow threedshadow threedhighlight;"">'")
'            mScript.AppendLine("    + ' <tr><td colspan=2 height=1></td></tr>';")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var cMenuList = '';")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var cMenuFooter = ''")
'            mScript.AppendLine("    + ' <tr><td colspan=2 height=1></td></tr>'")
'            mScript.AppendLine("    + '</table></div>';")
'            mScript.AppendLine("")
'            mScript.AppendLine("  for (var menuIdx in editor_cMenu.options) {")
'            mScript.AppendLine("    var menuName = editor_cMenu.options[menuIdx][0];")
'            mScript.AppendLine("    var menuKey  = editor_cMenu.options[menuIdx][1];")
'            mScript.AppendLine("    var menuCode = editor_cMenu.options[menuIdx][2];")
'            mScript.AppendLine("")
'            mScript.AppendLine("    if (menuName == ""---"" || menuName == ""separator"") {")
'            mScript.AppendLine("      cMenuList += ' <tr><td colspan=2 class=""cMenuDivOuter""><div class=""cMenuDivInner""></div></td></tr>';")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("")
'            mScript.AppendLine("    else {")
'            mScript.AppendLine("      cMenuList += '<tr class=""cMenu"" onMouseOver=""editor_cMenu(this)"" onMouseOut=""editor_cMenu(this)"" onClick=""editor_cMenu(this, \'' +menuIdx+ '\',\'' +objname+ '\')"">';")
'            mScript.AppendLine("      if (menuKey) { cMenuList += ' <td align=left class=""cMenu"">' +menuName+ '</td><td align=right class=""cMenu"">' +menuKey+ '</td>'; }")
'            mScript.AppendLine("      else         { cMenuList += ' <td colspan=2 class=""cMenu"">' +menuName+ '</td>'; }")
'            mScript.AppendLine("      cMenuList += '</tr>';")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  var cMenuHTML = cMenuHeader + cMenuList + cMenuFooter;")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("  document.all['_'+objname+'_cMenu'].outerHTML = cMenuHTML;")
'            mScript.AppendLine("")
'            mScript.AppendLine("  editor_cMenu_setPosition(parentWin, editorWin, objname);")
'            mScript.AppendLine("")
'            mScript.AppendLine("  parentWin['_'+objname+'_cMenu'].style.visibility = 'visible';")
'            mScript.AppendLine("  parentWin['_'+objname+'_cMenu'].focus();")
'            mScript.AppendLine("")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_cMenu_setPosition(parentWin, editorWin, objname) {      ")
'            mScript.AppendLine("  var event    = editorWin.event;")
'            mScript.AppendLine("  var cMenuObj = parentWin['_'+objname+'_cMenu'];")
'            mScript.AppendLine("  var mouseX   = event.clientX + parentWin.document.all['_'+objname+'_editor'].offsetLeft;")
'            mScript.AppendLine("  var mouseY   = event.clientY + parentWin.document.all['_'+objname+'_editor'].offsetTop;")
'            mScript.AppendLine("  var cMenuH   = cMenuObj.offsetHeight;")
'            mScript.AppendLine("  var cMenuW   = cMenuObj.offsetWidth;")
'            mScript.AppendLine("  var pageH    = document.body.clientHeight + document.body.scrollTop;")
'            mScript.AppendLine("  var pageW    = document.body.clientWidth + document.body.scrollLeft;")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (mouseX + 5 + cMenuW > pageW) { var left = mouseX - cMenuW - 5; } ")
'            mScript.AppendLine("  else                            { var left = mouseX + 5; }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  if (mouseY + 5 + cMenuH > pageH) { var top = mouseY - cMenuH + 5; } ")
'            mScript.AppendLine("  else                            { var top = mouseY + 5; }")
'            mScript.AppendLine("")
'            mScript.AppendLine("  cMenuObj.style.top = top;")
'            mScript.AppendLine("  cMenuObj.style.left = left;")
'            mScript.AppendLine("")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("")
'            mScript.AppendLine("function editor_cMenu(obj,menuIdx,objname) {")
'            mScript.AppendLine("  var action = event.type;")
'            mScript.AppendLine("  if      (action == ""mouseover"" && !obj.disabled && obj.tagName.toLowerCase() == 'tr') {")
'            mScript.AppendLine("    obj.className = 'cMenuOver';")
'            mScript.AppendLine("    for (var i=0; i < obj.cells.length; i++) { obj.cells[i].className = 'cMenuOver'; }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("  else if (action == ""mouseout"" && !obj.disabled && obj.tagName.toLowerCase() == 'tr')  {")
'            mScript.AppendLine("    obj.className = 'cMenu';")
'            mScript.AppendLine("    for (var i=0; i < obj.cells.length; i++) { obj.cells[i].className = 'cMenu'; }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("  else if (action == ""click"" && !obj.disabled) {")
'            mScript.AppendLine("    document.all['_'+objname+'_cMenu'].style.visibility = ""hidden"";")
'            mScript.AppendLine("    var menucode = editor_cMenu.options[menuIdx][2];")
'            mScript.AppendLine("    menucode();")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("  else if (action == ""blur"") {")
'            mScript.AppendLine("    if (!_isMouseOver(obj,event)) { obj.style.visibility = 'hidden'; }")
'            mScript.AppendLine("    else {")
'            mScript.AppendLine("      if (obj.style.visibility != ""hidden"") { obj.focus(); }")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("  }")
'            mScript.AppendLine("  else { alert(""editor_cMenu, unknown action: "" + action); }")
'            mScript.AppendLine("}")
'            mScript.AppendLine("")
'            mScript.AppendLine("-->")
'            mScript.AppendLine("</script>")

'            'REMOVE HTML TAGS
'            mScript.AppendLine("<script language=""javascript"">")
'            mScript.AppendLine("<!--")
'            mScript.AppendLine("function RemoveHtmlTags(html) {")
'            mScript.AppendLine("    if (html=='') {")
'            mScript.AppendLine("return '';")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("    else {")
'            mScript.AppendLine("        html = html.replace(/<BR>/g, '@ARAKKAL@');")
'            mScript.AppendLine("        html = _ScriptsStyleCleaner(html);")
'            mScript.AppendLine("    	html = html.replace(/<\/?[^>]+(>|$)/g,''); //  /<\/?[^>]+(>|$)/g or /<[^>]*>/g ")
'            mScript.AppendLine("        html = _SpaceCleaner(html);")
'            mScript.AppendLine("        html = html.replace(/@ARAKKAL@/g, '\r\n');")
'            mScript.AppendLine("        //html = html.replace('^', '');")
'            mScript.AppendLine("        return html;")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("}")
'            mScript.AppendLine(" ")
'            mScript.AppendLine("function _SpaceCleaner(pStr) {")
'            mScript.AppendLine("    var mRet = '';")
'            mScript.AppendLine("    var mSpaceFound = false;")
'            mScript.AppendLine("    pStr = pStr.replace(/\r\n/g, ' ')")
'            mScript.AppendLine("    pStr = pStr.replace(/\t/g, ' ')")
'            mScript.AppendLine("    pStr = pStr.replace(/&nbsp;/g, ' ')")
'            mScript.AppendLine("    for(cnt=1;cnt <= pStr.length;cnt++) {")
'            mScript.AppendLine("        var mC = Mid(pStr,cnt,1)")
'            mScript.AppendLine("        if (mC != ' ') {")
'            mScript.AppendLine("            mSpaceFound = false;")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("        if (!mSpaceFound) {")
'            mScript.AppendLine("            mRet = mRet + mC;")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("        if (mC == ' ') {")
'            mScript.AppendLine("            mSpaceFound = true;")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("    return mRet;")
'            mScript.AppendLine("}")
'            mScript.AppendLine(" ")
'            mScript.AppendLine("function _ScriptsStyleCleaner(pStr) {")
'            mScript.AppendLine("    var mStSkip = false;")
'            mScript.AppendLine("    var mScSkip = false")
'            mScript.AppendLine("    var mRet = ''")
'            mScript.AppendLine("    var mScSt = '<sc'+'ript';")
'            mScript.AppendLine("    var mScEnd = '</sc'+'ript>';")
'            mScript.AppendLine("    var mStSt  = '<st'+'yle';")
'            mScript.AppendLine("    var mStEnd  = '</st'+'yle>';")
'            mScript.AppendLine("    for(cnt=1;cnt <= pStr.length;cnt++) {")
'            mScript.AppendLine("        if (Mid(pStr, cnt, mScSt.length).toLowerCase() == mScSt) {")
'            mScript.AppendLine("            mScSkip = true;")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("        else if (Mid(pStr, cnt, mStSt.length).toLowerCase() == mStSt) {")
'            mScript.AppendLine("            mStSkip = true;")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("        if (!mScSkip && !mStSkip) {")
'            mScript.AppendLine("            mRet = mRet + Mid(pStr, cnt, 1);")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("        if (Mid(pStr, cnt, mScEnd.length).toLowerCase() == mScEnd) {")
'            mScript.AppendLine("            cnt = cnt + (mScEnd.length - 1);")
'            mScript.AppendLine("            mScSkip = false;")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("        else if (Mid(pStr, cnt, mStEnd.length).toLowerCase() == mStEnd) {")
'            mScript.AppendLine("            cnt = cnt + (mStEnd.length - 1);")
'            mScript.AppendLine("            mStSkip = false;")
'            mScript.AppendLine("        }")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("    return mRet;")
'            mScript.AppendLine("}")
'            mScript.AppendLine(" ")
'            mScript.AppendLine("function Mid(str, start, len)")
'            mScript.AppendLine("{")
'            mScript.AppendLine("    if (start <= 0 || len < 0) return '';")
'            mScript.AppendLine("    var iEnd, iLen = String(str).length;")
'            mScript.AppendLine("    if ((start-1) + len > iLen) {")
'            mScript.AppendLine("          iEnd = iLen;")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("    else {")
'            mScript.AppendLine("          iEnd = (start-1) + len;")
'            mScript.AppendLine("    }")
'            mScript.AppendLine("    return String(str).substring((start-1),iEnd);")
'            mScript.AppendLine("}")

'            mScript.AppendLine("-->")
'            mScript.AppendLine("</script>")

'            Return mScript.ToString

'        End Function

'        Private Function EditorScript3() As ArrayList
'            Dim mScr As ArrayList = Me.EditorSCript2
'            For cnt As Integer = 0 To mScr.Count - 1
'                mScr(cnt) = Replace(mScr(cnt), """", "\""")
'            Next
'            Return mScr
'        End Function

'        'POPUP WINDOW EDITOR
'        Private Function EditorSCript2() As ArrayList
'            Dim mScript As New ArrayList
'            mScript.Add("<html>")
'            mScript.Add("<head><title>Fullscreen Editor</title>")
'            mScript.Add("<style type=""text/css""> body {	margin: 0px; border: 0px; background-color: buttonface; } </style>")
'            mScript.Add("<script language=""Javascript1.2"">")

'            '''TODO
'            'mScript.Add("<!--")
'            mScript.Add("[Org]") 'this will replace wih Parent Object Name - Dont change this position it must be at 5th
'            mScript.Add("_editor_url = """ & mEditorURL & """;                     ")
'            mScript.Add("")
'            mScript.Add("document.write('<style type=""text/css"">\\n');")
'            mScript.Add("document.write('.btn     { width: 22px; height: 22px; border: 1px solid buttonface; margin: 0; padding: 0; }\\n');")
'            mScript.Add("document.write('.btnOver { width: 22px; height: 22px; border: 1px outset; }\\n');")
'            mScript.Add("document.write('.btnDown { width: 22px; height: 22px; border: 1px inset; background-color: buttonhighlight; }\\n');")
'            mScript.Add("document.write('.btnNA   { width: 22px; height: 22px; border: 1px solid buttonface; filter: alpha(opacity=25); }\\n');")
'            mScript.Add("document.write('.cMenu     { background-color: threedface; color: menutext; cursor: Default; font-family: MS Sans Serif; font-size: 8pt; padding: 2 12 2 16; }');")
'            mScript.Add("document.write('.cMenuOver { background-color: highlight; color: highlighttext; cursor: Default; font-family: MS Sans Serif; font-size: 8pt; padding: 2 12 2 16; }');")
'            mScript.Add("document.write('.cMenuDivOuter { background-color: threedface; height: 9 }');")
'            mScript.Add("document.write('.cMenuDivInner { margin: 0 4 0 4; border-width: 1; border-style: solid; border-color: threedshadow threedhighlight threedhighlight threedshadow; }');")
'            mScript.Add("document.write('</style>\\n');")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_defaultConfig(objname) {")
'            mScript.Add("")
'            mScript.Add("this.version = ""2.03""")
'            mScript.Add("")
'            mScript.Add("this.width =  ""auto"";")
'            mScript.Add("this.height = ""auto"";")
'            mScript.Add("this.bodyStyle = 'background-color: #FFFFFF; font-family: ""Verdana""; font-size: x-small;';")
'            mScript.Add("this.imgURL = _editor_url + ''; ")
'            mScript.Add("this.debug  = 0;")
'            mScript.Add("")
'            mScript.Add("this.replaceNextlines = 0; ")
'            mScript.Add("this.plaintextInput = 0;   ")
'            mScript.Add("")
'            mScript.Add("this.toolbar = [")
'            mScript.Add("    ['fontname'],")
'            mScript.Add("    ['fontsize'],")
'            mScript.Add("    ['bold','italic','underline','separator'],")
'            mScript.Add("    ['justifyleft','justifycenter','justifyright','separator'],")
'            mScript.Add("    ['OrderedList','UnOrderedList','Outdent','Indent','separator'],")
'            mScript.Add("    ['forecolor','backcolor','separator'],")
'            mScript.Add("    ['HorizontalRule','Createlink','InsertImage','InsertTable','htmlmode','separator'],")
'            mScript.Add("    ['popupeditor'" & IIf(mShowAbout, ",'about'", "") & "]];")
'            mScript.Add("")
'            mScript.Add("this.fontnames = {")
'            mScript.Add("    ""Arial"":           ""arial, helvetica, sans-serif"",")
'            mScript.Add("    ""Courier New"":     ""courier new, courier, mono"",")
'            mScript.Add("    ""Georgia"":         ""Georgia, Times New Roman, Times, Serif"",")
'            mScript.Add("    ""Tahoma"":          ""Tahoma, Arial, Helvetica, sans-serif"",")
'            mScript.Add("    ""Times New Roman"": ""times new roman, times, serif"",")
'            mScript.Add("    ""Verdana"":         ""Verdana, Arial, Helvetica, sans-serif"",")
'            mScript.Add("    ""impact"":          ""impact"",")
'            mScript.Add("    ""WingDings"":       ""WingDings""};")
'            mScript.Add("")
'            mScript.Add("this.fontsizes = {")
'            mScript.Add("    ""1 (8 pt)"":  ""1"",")
'            mScript.Add("    ""2 (10 pt)"": ""2"",")
'            mScript.Add("    ""3 (12 pt)"": ""3"",")
'            mScript.Add("    ""4 (14 pt)"": ""4"",")
'            mScript.Add("    ""5 (18 pt)"": ""5"",")
'            mScript.Add("    ""6 (24 pt)"": ""6"",")
'            mScript.Add("    ""7 (36 pt)"": ""7""")
'            mScript.Add("  };")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("this.fontstyles = [     ")
'            mScript.Add("];")
'            mScript.Add("")
'            mScript.Add("this.btnList = {")
'            mScript.Add("    ""bold"":           ['Bold',                 'Bold',               'editor_action(this.id)',  '" & Images_ed_format_bold_gif & "'],")
'            mScript.Add("    ""italic"":         ['Italic',               'Italic',             'editor_action(this.id)',  '" & Images_ed_format_italic_gif & "'],")
'            mScript.Add("    ""underline"":      ['Underline',            'Underline',          'editor_action(this.id)',  '" & Images_ed_format_underline_gif & "'],")
'            mScript.Add("    ""strikethrough"":  ['StrikeThrough',        'Strikethrough',      'editor_action(this.id)',  '" & Images_ed_format_strike_gif & "'],")
'            mScript.Add("    ""subscript"":      ['SubScript',            'Subscript',          'editor_action(this.id)',  '" & Images_ed_format_sub_gif & "'],")
'            mScript.Add("    ""superscript"":    ['SuperScript',          'Superscript',        'editor_action(this.id)',  '" & Images_ed_format_sup_gif & "'],")
'            mScript.Add("    ""justifyleft"":    ['JustifyLeft',          'Justify Left',       'editor_action(this.id)',  '" & Images_ed_align_left_gif & "'],")
'            mScript.Add("    ""justifycenter"":  ['JustifyCenter',        'Justify Center',     'editor_action(this.id)',  '" & Images_ed_align_center_gif & "'],")
'            mScript.Add("    ""justifyright"":   ['JustifyRight',         'Justify Right',      'editor_action(this.id)',  '" & Images_ed_align_right_gif & "'],")
'            mScript.Add("    ""orderedlist"":    ['InsertOrderedList',    'Ordered List',       'editor_action(this.id)',  '" & Images_ed_list_num_gif & "'],")
'            mScript.Add("    ""unorderedlist"":  ['InsertUnorderedList',  'Bulleted List',      'editor_action(this.id)',  '" & Images_ed_list_bullet_gif & "'],")
'            mScript.Add("    ""outdent"":        ['Outdent',              'Decrease Indent',    'editor_action(this.id)',  '" & Images_ed_indent_less_gif & "'],")
'            mScript.Add("    ""indent"":         ['Indent',               'Increase Indent',    'editor_action(this.id)',  '" & Images_ed_indent_more_gif & "'],")
'            mScript.Add("    ""forecolor"":      ['ForeColor',            'Font Color',         'editor_action(this.id)',  '" & Images_ed_color_fg_gif & "'],")
'            mScript.Add("    ""backcolor"":      ['BackColor',            'Background Color',   'editor_action(this.id)',  '" & Images_ed_color_bg_gif & "'],")
'            mScript.Add("    ""horizontalrule"": ['InsertHorizontalRule', 'Horizontal Rule',    'editor_action(this.id)',  '" & Images_ed_hr_gif & "'],")
'            mScript.Add("    ""createlink"":     ['CreateLink',           'Insert Web Link',    'editor_action(this.id)',  '" & Images_ed_link_gif & "'],")
'            mScript.Add("    ""insertimage"":    ['InsertImage',          'Insert Image',       'editor_action(this.id)',  '" & Images_ed_image_gif & "'],")
'            mScript.Add("    ""inserttable"":    ['InsertTable',          'Insert Table',       'editor_action(this.id)',  '" & Images_insert_table_gif & "'],")
'            mScript.Add("    ""htmlmode"":       ['HtmlMode',             'View HTML Source',   'editor_setmode(\\''+objname+'\\')', '" & Images_ed_html_gif & "'],")
'            mScript.Add("    ""popupeditor"":    ['popupeditor',          'Enlarge Editor',     'editor_action(this.id)',  '" & Images_fullscreen_maximize_gif & "'],")
'            mScript.Add("")
'            mScript.Add("    ""custom1"":           ['custom1',         'Purpose of button 1',  'editor_action(this.id)',  '" & Images_ed_custom_gif & "'],")
'            mScript.Add("    ""custom2"":           ['custom2',         'Purpose of button 2',  'editor_action(this.id)',  '" & Images_ed_custom_gif & "'],")
'            mScript.Add("    ""custom3"":           ['custom3',         'Purpose of button 3',  'editor_action(this.id)',  '" & Images_ed_custom_gif & "'],")
'            mScript.Add("")
'            mScript.Add("    ""help"":           ['showhelp',             'Help using editor',  'editor_action(this.id)',  '" & Images_ed_help_gif & "']};")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("}")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("")

'            mScript.Add("function editor_generate(objname,userConfig) {")
'            mScript.Add("")
'            'mScript.Add(" alert('editor_generate called');  ")
'            mScript.Add("  var config = new editor_defaultConfig(objname);")
'            mScript.Add("  if (userConfig) { ")
'            mScript.Add("    for (var thisName in userConfig) {")
'            mScript.Add("      if (userConfig[thisName]) { config[thisName] = userConfig[thisName]; }")
'            mScript.Add("    }")
'            mScript.Add("  }")
'            mScript.Add("  document.all[objname].config = config;                  ")
'            mScript.Add("")
'            mScript.Add("  var obj    = document.all[objname];")
'            mScript.Add("  if (!config.width || config.width == ""auto"") {")
'            mScript.Add("    if      (obj.style.width) { config.width = obj.style.width; }      ")
'            mScript.Add("    else if (obj.cols)        { config.width = (obj.cols * 8) + 22; }  ")
'            mScript.Add("    else                      { config.width = '100%'; }               ")
'            mScript.Add("  }")
'            mScript.Add("  if (!config.height || config.height == ""auto"") {")
'            mScript.Add("    if      (obj.style.height) { config.height = obj.style.height; }   ")
'            mScript.Add("    else if (obj.rows)         { config.height = obj.rows * 17 }       ")
'            mScript.Add("    else                       { config.height = '200'; }              ")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  var tblOpen  = '<table border=0 cellspacing=0 cellpadding=0 style=""float: left;""  unselectable=""on""><tr><td style=""border: none; padding: 1 0 0 0""><nobr>';")
'            mScript.Add("  var tblClose = '</nobr></td></tr></table>\\n';")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("  var toolbar = '';")
'            mScript.Add("  var btnGroup, btnItem, aboutEditor;")
'            mScript.Add("  for (var btnGroup in config.toolbar) {")
'            mScript.Add("")
'            mScript.Add("    if (config.toolbar[btnGroup].length == 1 &&")
'            mScript.Add("        config.toolbar[btnGroup][0].toLowerCase() == ""linebreak"") {")
'            mScript.Add("      toolbar += '<br clear=""all"">';")
'            mScript.Add("      continue;")
'            mScript.Add("    }")
'            mScript.Add("")
'            mScript.Add("    toolbar += tblOpen;")
'            mScript.Add("    for (var btnItem in config.toolbar[btnGroup]) {")
'            mScript.Add("      var btnName = config.toolbar[btnGroup][btnItem].toLowerCase();")
'            mScript.Add("")
'            mScript.Add("      if (btnName == ""fontname"") {")
'            mScript.Add("        toolbar += '<select id=""_' +objname+ '_FontName"" onChange=""editor_action(this.id)"" unselectable=""on"" style=""margin: 1 2 0 2; font-size: 12px;"">';")
'            mScript.Add("        for (var fontname in config.fontnames) {")
'            mScript.Add("          toolbar += '<option value=""' +config.fontnames[fontname]+ '"">' +fontname+ '</option>'")
'            mScript.Add("        }")
'            mScript.Add("        toolbar += '</select>';")
'            mScript.Add("        continue;")
'            mScript.Add("      }")
'            mScript.Add("")
'            mScript.Add("      if (btnName == ""fontsize"") {")
'            mScript.Add("        toolbar += '<select id=""_' +objname+ '_FontSize"" onChange=""editor_action(this.id)"" unselectable=""on"" style=""margin: 1 2 0 0; font-size: 12px;"">';")
'            mScript.Add("        for (var fontsize in config.fontsizes) {")
'            mScript.Add("          toolbar += '<option value=""' +config.fontsizes[fontsize]+ '"">' +fontsize+ '</option>'")
'            mScript.Add("        }")
'            mScript.Add("        toolbar += '</select>\\n';")
'            mScript.Add("        continue;")
'            mScript.Add("      }")
'            mScript.Add("")
'            mScript.Add("      if (btnName == ""fontstyle"") {")
'            mScript.Add("        toolbar += '<select id=""_' +objname+ '_FontStyle"" onChange=""editor_action(this.id)"" unselectable=""on"" style=""margin: 1 2 0 0; font-size: 12px;"">';")
'            mScript.Add("        + '<option value="""">Font Style</option>';")
'            mScript.Add("        for (var i in config.fontstyles) {")
'            mScript.Add("          var fontstyle = config.fontstyles[i];")
'            mScript.Add("          toolbar += '<option value=""' +fontstyle.className+ '"">' +fontstyle.name+ '</option>'")
'            mScript.Add("        }")
'            mScript.Add("        toolbar += '</select>';")
'            mScript.Add("        continue;")
'            mScript.Add("      }")
'            mScript.Add("")
'            mScript.Add("      if (btnName == ""separator"") {")
'            mScript.Add("        toolbar += '<span style=""border: 1px inset; width: 1px; font-size: 16px; height: 16px; margin: 0 3 0 3""></span>';")
'            mScript.Add("        continue;")
'            mScript.Add("      }")
'            mScript.Add("")
'            mScript.Add("      var btnObj = config.btnList[btnName];")
'            mScript.Add("      if (btnName == 'linebreak') { alert(""htmlArea error: 'linebreak' must be in a subgroup by itself, not with other buttons.\\n\\nhtmlArea wysiwyg editor not created.""); return; }")
'            mScript.Add("      if (!btnObj) { alert(""htmlArea error: button '"" +btnName+ ""' not found in button list when creating the wysiwyg editor for '""+objname+""'.\\nPlease make sure you entered the button name correctly.\\n\\nhtmlArea wysiwyg editor not created.""); return; }")
'            mScript.Add("      var btnCmdID   = btnObj[0];")
'            mScript.Add("      var btnTitle   = btnObj[1];")
'            mScript.Add("      var btnOnClick = btnObj[2];")
'            mScript.Add("      var btnImage   = btnObj[3];")
'            mScript.Add("      toolbar += '<button title=""' +btnTitle+ '"" id=""_' +objname+ '_' +btnCmdID+ '"" class=""btn"" onClick=""' +btnOnClick+ '"" onmouseover=""if(this.className==\\'btn\\'){this.className=\\'btnOver\\'}"" onmouseout=""if(this.className==\\'btnOver\\'){this.className=\\'btn\\'}"" unselectable=""on""><img src=""' +config.imgURL + btnImage+ '"" border=0 unselectable=""on""></button>';")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("    } ")
'            mScript.Add("    toolbar += tblClose;")
'            mScript.Add("  } ")
'            mScript.Add("")
'            mScript.Add("  var editor = '<span id=""_editor_toolbar""><table border=0 cellspacing=0 cellpadding=0 bgcolor=""buttonface"" style=""padding: 1 0 0 2"" width=' + config.width + ' unselectable=""on""><tr><td>\\n'")
'            mScript.Add("  + toolbar")
'            mScript.Add("  + '</td></tr></table>\\n'")
'            mScript.Add("  + '</td></tr></table></span>\\n'")
'            mScript.Add("  + '<textarea ID=""_' +objname + '_editor"" style=""width:' +config.width+ '; height:' +config.height+ '; margin-top: -1px; margin-bottom: -1px;"" wrap=soft></textarea>';")
'            mScript.Add("")
'            mScript.Add("  editor += '<div id=""_' +objname + '_cMenu"" style=""position: absolute; visibility: hidden;""></div>';")
'            mScript.Add("")
'            mScript.Add("  if (!config.debug) { document.all[objname].style.display = ""none""; }")
'            mScript.Add("")
'            mScript.Add("  if (config.plaintextInput) {     ")
'            mScript.Add("    var contents = document.all[objname].value;")
'            mScript.Add("    contents = contents.replace(/\\r\\n/g, '<br>');")
'            mScript.Add("    contents = contents.replace(/\\n/g, '<br>');")
'            mScript.Add("    contents = contents.replace(/\\r/g, '<br>');")
'            mScript.Add("    document.all[objname].value = contents;")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  document.all[objname].insertAdjacentHTML('afterEnd', editor)")
'            mScript.Add("")
'            mScript.Add("  editor_setmode(objname, 'init');")
'            mScript.Add("")
'            mScript.Add("  for (var idx=0; idx < document.forms.length; idx++) {")
'            mScript.Add("    var r = document.forms[idx].attachEvent('onsubmit', function() { editor_filterOutput(objname); });")
'            mScript.Add("    if (!r) { alert(""Error attaching event to form!""); }")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("return true;")
'            mScript.Add("")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_action(button_id) {")
'            mScript.Add("")
'            mScript.Add("  var BtnParts = Array();")
'            mScript.Add("  BtnParts = button_id.split(""_"");")
'            mScript.Add("  var objname    = button_id.replace(/^_(.*)_[^_]*$/, '$1');")
'            mScript.Add("  var cmdID      = BtnParts[ BtnParts.length-1 ];")
'            mScript.Add("  var button_obj = document.all[button_id];")
'            mScript.Add("  var editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.Add("  var config     = document.all[objname].config;")
'            mScript.Add("")
'            mScript.Add("  if (cmdID == 'showhelp') {")
'            mScript.Add("    window.open(_editor_url + """ & Popup_editor_help_html & """, 'EditorHelp');")
'            mScript.Add("    return;")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  if (editor_obj.tagName.toLowerCase() == 'textarea') { return; }")
'            mScript.Add("")
'            mScript.Add("  var editdoc = editor_obj.contentWindow.document;")
'            mScript.Add("  editor_focus(editor_obj);")
'            mScript.Add("")
'            mScript.Add("  var idx = button_obj.selectedIndex;")
'            mScript.Add("  var val = (idx != null) ? button_obj[ idx ].value : null;")
'            mScript.Add("")
'            mScript.Add("  if (0) {}   ")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("  else if (cmdID == 'custom1') {")
'            mScript.Add("    alert(""Hello, I am custom button 1!"");")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  else if (cmdID == 'custom2') {  ")
'            mScript.Add("    var myTitle = ""This is a custom title"";")
'            mScript.Add("    var myText = showModalDialog(_editor_url + """ & Popup_custom2_html & """,")
'            mScript.Add("                                 myTitle,      ")
'            mScript.Add("                                 ""resizable: yes; help: no; status: no; scroll: no; "");")
'            mScript.Add("    if (myText) { editor_insertHTML(objname, myText); }")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  else if (cmdID == 'custom3') {  ")
'            mScript.Add("    editor_insertHTML(objname, ""It's easy to add buttons that insert text!"");")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("  else if (cmdID == 'FontName' && val) {")
'            mScript.Add("    editdoc.execCommand(cmdID,0,val);")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  else if (cmdID == 'FontSize' && val) {")
'            mScript.Add("    editdoc.execCommand(cmdID,0,val);")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  else if (cmdID == 'FontStyle' && val) {")
'            mScript.Add("    editdoc.execCommand('RemoveFormat');")
'            mScript.Add("    editdoc.execCommand('FontName',0,'636c6173734e616d6520706c616365686f6c646572');")
'            mScript.Add("    var fontArray = editdoc.all.tags(""FONT"");")
'            mScript.Add("    for (i=0; i<fontArray.length; i++) {")
'            mScript.Add("      if (fontArray[i].face == '636c6173734e616d6520706c616365686f6c646572') {")
'            mScript.Add("        fontArray[i].face = """";")
'            mScript.Add("        fontArray[i].className = val;")
'            mScript.Add("        fontArray[i].outerHTML = fontArray[i].outerHTML.replace(/face=['""]+/, """");")
'            mScript.Add("        }")
'            mScript.Add("    }")
'            mScript.Add("    button_obj.selectedIndex =0;")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  else if (cmdID == 'ForeColor' || cmdID == 'BackColor') {")
'            mScript.Add("    var oldcolor = _dec_to_rgb(editdoc.queryCommandValue(cmdID));")
'            mScript.Add("    var newcolor = showModalDialog(_editor_url + """ & Popup_select_color_html & """, oldcolor, ""resizable: no; help: no; status: no; scroll: no;"");")
'            mScript.Add("    if (newcolor != null) { editdoc.execCommand(cmdID, false, ""#""+newcolor); }")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  else {")
'            mScript.Add("    if (cmdID.toLowerCase() == 'subscript' && editdoc.queryCommandState('superscript')) { editdoc.execCommand('superscript'); }")
'            mScript.Add("    if (cmdID.toLowerCase() == 'superscript' && editdoc.queryCommandState('subscript')) { editdoc.execCommand('subscript'); }")
'            mScript.Add("")
'            mScript.Add("    if (cmdID.toLowerCase() == 'createlink'){")
'            mScript.Add("      editdoc.execCommand(cmdID,1);")
'            mScript.Add("    }")
'            mScript.Add("")
'            mScript.Add("    else if (cmdID.toLowerCase() == 'insertimage'){")
'            mScript.Add("      showModalDialog(_editor_url + """ & Popup_insert_image_html & """, editdoc, ""resizable: no; help: no; status: no; scroll: no; "");")
'            mScript.Add("    }")
'            mScript.Add("")
'            mScript.Add("    else if (cmdID.toLowerCase() == 'inserttable'){")
'            'mScript.Add("      alert(_editor_url + """ & Popup_insert_table_html & "?""+objname)")
'            mScript.Add("      showModalDialog(_editor_url + """ & Popup_insert_table_html & "?""+objname,")
'            mScript.Add("                                 window,")
'            mScript.Add("                                 ""resizable: yes; help: no; status: no; scroll: no; "");")
'            mScript.Add("    }")
'            mScript.Add("")
'            mScript.Add("    else { editdoc.execCommand(cmdID); }")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  editor_event(objname);")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")

'            mScript.Add("function editor_event(objname,runDelay) {")

'            'mScript.Add("    document.title = editor_getHTML(objname).length")

'            mScript.Add("  var config = document.all[objname].config;")
'            mScript.Add("  var editor_obj  = document.all[""_"" +objname+  ""_editor""];       ")
'            mScript.Add("  if (runDelay == null) { runDelay = 0; }")
'            mScript.Add("  var editdoc;")
'            mScript.Add("  var editEvent = editor_obj.contentWindow ? editor_obj.contentWindow.event : event;")
'            mScript.Add("")
'            mScript.Add("    if (editEvent && editEvent.keyCode) {")
'            mScript.Add("      var ord       = editEvent.keyCode;    ")
'            mScript.Add("      var ctrlKey   = editEvent.ctrlKey;")
'            mScript.Add("      var altKey    = editEvent.altKey;")
'            mScript.Add("      var shiftKey  = editEvent.shiftKey;")
'            mScript.Add("")
'            mScript.Add("      if (ord == 16) { return; }  ")
'            mScript.Add("      if (ord == 17) { return; }  ")
'            mScript.Add("      if (ord == 18) { return; }  ")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("      if (ctrlKey && (ord == 122 || ord == 90)) {     ")
'            mScript.Add("        return;")
'            mScript.Add("      }")
'            mScript.Add("      if ((ctrlKey && (ord == 121 || ord == 89)) ||")
'            mScript.Add("          ctrlKey && shiftKey && (ord == 122 || ord == 90)) {     ")
'            mScript.Add("        return;")
'            mScript.Add("      }")
'            mScript.Add("    }")
'            mScript.Add("")
'            mScript.Add("  if (runDelay > 0) { return setTimeout(function(){ editor_event(objname); }, runDelay); }")
'            mScript.Add("")
'            mScript.Add("  if (this.tooSoon == 1 && runDelay >= 0) { this.queue = 1; return; } ")
'            mScript.Add("  this.tooSoon = 1;")
'            mScript.Add("  setTimeout(function(){")
'            mScript.Add("    this.tooSoon = 0;")
'            mScript.Add("    if (this.queue) { editor_event(objname,-1); };")
'            mScript.Add("    this.queue = 0;")
'            mScript.Add("    }, 333);  ")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("  editor_updateOutput(objname);")
'            mScript.Add("  editor_updateToolbar(objname);")
'            mScript.Add("")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_updateToolbar(objname,action) {")
'            mScript.Add("  var config = document.all[objname].config;")
'            mScript.Add("  var editor_obj  = document.all[""_"" +objname+  ""_editor""];")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("  if (action == ""enable"" || action == ""disable"") {")
'            mScript.Add("    var tbItems = new Array('FontName','FontSize','FontStyle');                           ")
'            mScript.Add("    for (var btnName in config.btnList) { tbItems.push(config.btnList[btnName][0]); } ")
'            mScript.Add("")
'            mScript.Add("    for (var idxN in tbItems) {")
'            mScript.Add("      var cmdID = tbItems[idxN].toLowerCase();")
'            mScript.Add("      var tbObj = document.all[""_"" +objname+ ""_"" +tbItems[idxN]];")
'            mScript.Add("      if (cmdID == ""htmlmode"" || cmdID == ""about"" || cmdID == ""showhelp"" || cmdID == ""popupeditor"") { continue; } ")
'            mScript.Add("      if (tbObj == null) { continue; }")
'            mScript.Add("      var isBtn = (tbObj.tagName.toLowerCase() == ""button"") ? true : false;")
'            mScript.Add("")
'            mScript.Add("      if (action == ""enable"")  { tbObj.disabled = false; if (isBtn) { tbObj.className = 'btn' }}")
'            mScript.Add("      if (action == ""disable"") { tbObj.disabled = true;  if (isBtn) { tbObj.className = 'btnNA' }}")
'            mScript.Add("    }")
'            mScript.Add("    return;")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("  if (editor_obj.tagName.toLowerCase() == 'textarea') { return; }   ")
'            mScript.Add("  var editdoc = editor_obj.contentWindow.document;")
'            mScript.Add("")
'            mScript.Add("  var fontname_obj = document.all[""_"" +objname+ ""_FontName""];")
'            mScript.Add("  if (fontname_obj) {")
'            mScript.Add("    var fontname = editdoc.queryCommandValue('FontName');")
'            mScript.Add("    if (fontname == null) { fontname_obj.value = null; }")
'            mScript.Add("    else {")
'            mScript.Add("      var found = 0;")
'            mScript.Add("      for (i=0; i<fontname_obj.length; i++) {")
'            mScript.Add("        if (fontname.toLowerCase() == fontname_obj[i].text.toLowerCase()) {")
'            mScript.Add("          fontname_obj.selectedIndex = i;")
'            mScript.Add("          found = 1;")
'            mScript.Add("        }")
'            mScript.Add("      }")
'            mScript.Add("      if (found != 1) { fontname_obj.value = null; }     ")
'            mScript.Add("    }")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  var fontsize_obj = document.all[""_"" +objname+ ""_FontSize""];")
'            mScript.Add("  if (fontsize_obj) {")
'            mScript.Add("    var fontsize = editdoc.queryCommandValue('FontSize');")
'            mScript.Add("    if (fontsize == null) { fontsize_obj.value = null; }")
'            mScript.Add("    else {")
'            mScript.Add("      var found = 0;")
'            mScript.Add("      for (i=0; i<fontsize_obj.length; i++) {")
'            mScript.Add("        if (fontsize == fontsize_obj[i].value) { fontsize_obj.selectedIndex = i; found=1; }")
'            mScript.Add("      }")
'            mScript.Add("      if (found != 1) { fontsize_obj.value = null; }    ")
'            mScript.Add("    }")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  var classname_obj = document.all[""_"" +objname+ ""_FontStyle""];")
'            mScript.Add("  if (classname_obj) {")
'            mScript.Add("    var curRange = editdoc.selection.createRange();")
'            mScript.Add("")
'            mScript.Add("    var pElement;")
'            mScript.Add("    if (curRange.length) { pElement = curRange[0]; }              ")
'            mScript.Add("    else                 { pElement = curRange.parentElement(); } ")
'            mScript.Add("    while (pElement && !pElement.className) { pElement = pElement.parentElement; }  ")
'            mScript.Add("")
'            mScript.Add("    var thisClass = pElement ? pElement.className.toLowerCase() : """";")
'            mScript.Add("    if (!thisClass && classname_obj.value) { classname_obj.value = null; }")
'            mScript.Add("    else {")
'            mScript.Add("      var found = 0;")
'            mScript.Add("      for (i=0; i<classname_obj.length; i++) {")
'            mScript.Add("        if (thisClass == classname_obj[i].value.toLowerCase()) {")
'            mScript.Add("          classname_obj.selectedIndex = i;")
'            mScript.Add("          found=1;")
'            mScript.Add("        }")
'            mScript.Add("      }")
'            mScript.Add("      if (found != 1) { classname_obj.value = null; }     ")
'            mScript.Add("    }")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  var IDList = Array('Bold','Italic','Underline','StrikeThrough','SubScript','SuperScript','JustifyLeft','JustifyCenter','JustifyRight','InsertOrderedList','InsertUnorderedList');")
'            mScript.Add("  for (i=0; i<IDList.length; i++) {")
'            mScript.Add("    var btnObj = document.all[""_"" +objname+ ""_"" +IDList[i]];")
'            mScript.Add("    if (btnObj == null) { continue; }")
'            mScript.Add("    var cmdActive = editdoc.queryCommandState( IDList[i] );")
'            mScript.Add("")
'            mScript.Add("    if (!cmdActive)  {                                  ")
'            mScript.Add("      if (btnObj.className != 'btn') { btnObj.className = 'btn'; }")
'            mScript.Add("      if (btnObj.disabled  != false) { btnObj.disabled = false; }")
'            mScript.Add("    } else if (cmdActive)  {                            ")
'            mScript.Add("      if (btnObj.className != 'btnDown') { btnObj.className = 'btnDown'; }")
'            mScript.Add("      if (btnObj.disabled  != false)   { btnObj.disabled = false; }")
'            mScript.Add("    }")
'            mScript.Add("  }")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_updateOutput(objname) {")
'            mScript.Add("  var config     = document.all[objname].config;")
'            mScript.Add("  var editor_obj  = document.all[""_"" +objname+  ""_editor""];       ")
'            mScript.Add("  var editEvent = editor_obj.contentWindow ? editor_obj.contentWindow.event : event;")
'            mScript.Add("  var isTextarea = (editor_obj.tagName.toLowerCase() == 'textarea');")
'            mScript.Add("  var editdoc = isTextarea ? null : editor_obj.contentWindow.document;")
'            mScript.Add("")
'            mScript.Add("  var contents;")
'            mScript.Add("  if (isTextarea) { contents = editor_obj.value; }")
'            mScript.Add("  else            { contents = editdoc.body.innerHTML; }")
'            mScript.Add("")
'            mScript.Add("  if (config.lastUpdateOutput && config.lastUpdateOutput == contents) { return; }")
'            mScript.Add("  else { config.lastUpdateOutput = contents; }")
'            mScript.Add("")
'            mScript.Add("  document.all[objname].value = contents;")
'            mScript.Add("")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_filterOutput(objname) {")
'            mScript.Add("  editor_updateOutput(objname);")
'            mScript.Add("  var contents = document.all[objname].value;")
'            mScript.Add("  var config   = document.all[objname].config;")
'            mScript.Add("")
'            mScript.Add("  if (contents.toLowerCase() == '<p>&nbsp;</p>') { contents = """"; }")
'            mScript.Add("")
'            mScript.Add("  var filterTag = function(tagBody,tagName,tagAttr) {")
'            mScript.Add("    tagName = tagName.toLowerCase();")
'            mScript.Add("    var closingTag = (tagBody.match(/^<\\//)) ? true : false;")
'            mScript.Add("")
'            mScript.Add("    if (tagName == 'img') { tagBody = tagBody.replace(/(src\\s*=\\s*.)[^*]*(\\*\\*\\*)/, ""$1$2""); }")
'            mScript.Add("    if (tagName == 'a')   { tagBody = tagBody.replace(/(href\\s*=\\s*.)[^*]*(\\*\\*\\*)/, ""$1$2""); }")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("    return tagBody;")
'            mScript.Add("  };")
'            mScript.Add("")
'            mScript.Add("  RegExp.lastIndex = 0;")
'            mScript.Add("    var matchTag = /<\\/?(\\w+)((?:[^'"">]*|'[^']*'|""[^""]*"")*)>/g;   ")
'            mScript.Add("")
'            mScript.Add("  contents = contents.replace(matchTag, filterTag);")
'            mScript.Add("")
'            mScript.Add("  if (config.replaceNextlines) { ")
'            mScript.Add("    contents = contents.replace(/\\r\\n/g, ' ');")
'            mScript.Add("    contents = contents.replace(/\\n/g, ' ');")
'            mScript.Add("    contents = contents.replace(/\\r/g, ' ');")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  document.all[objname].value = contents;")
'            mScript.Add("")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_setmode(objname, mode) {")
'            mScript.Add("  var config     = document.all[objname].config;")
'            mScript.Add("  var editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.Add("")
'            mScript.Add("  if (document.readyState != 'complete') {")
'            mScript.Add("    setTimeout(function() { editor_setmode(objname,mode) }, 25);")
'            mScript.Add("    return;")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  var TextEdit   = '<textarea ID=""_' +objname + '_editor"" style=""width:' +editor_obj.style.width+ '; height:' +editor_obj.style.height+ '; margin-top: -1px; margin-bottom: -1px;""></textarea>';")
'            mScript.Add("  var RichEdit   = '<iframe ID=""_' +objname+ '_editor""    style=""width:' +editor_obj.style.width+ '; height:' +editor_obj.style.height+ ';""></iframe>';")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("  if (mode == ""textedit"" || editor_obj.tagName.toLowerCase() == 'iframe') {")
'            mScript.Add("    config.mode = ""textedit"";")
'            mScript.Add("    var editdoc = editor_obj.contentWindow.document;")
'            mScript.Add("    var contents = editdoc.body.createTextRange().htmlText;")
'            mScript.Add("    editor_obj.outerHTML = TextEdit;")
'            mScript.Add("    editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.Add("    editor_obj.value = contents;")
'            mScript.Add("    editor_event(objname);")
'            mScript.Add("")
'            mScript.Add("    editor_updateToolbar(objname, ""disable"");  ")
'            mScript.Add("")
'            mScript.Add("    editor_obj.onkeydown   = function() { editor_event(objname); }")
'            mScript.Add("    editor_obj.onkeypress  = function() { editor_event(objname); }")
'            mScript.Add("    editor_obj.onkeyup     = function() { editor_event(objname); }")
'            mScript.Add("    editor_obj.onmouseup   = function() { editor_event(objname); }")
'            mScript.Add("    editor_obj.ondrop      = function() { editor_event(objname, 100); }     ")
'            mScript.Add("    editor_obj.oncut       = function() { editor_event(objname, 100); }")
'            mScript.Add("    editor_obj.onpaste     = function() { editor_event(objname, 100); }")
'            mScript.Add("    editor_obj.onblur      = function() { editor_event(objname, -1); }")
'            mScript.Add("")
'            mScript.Add("    editor_updateOutput(objname);")
'            mScript.Add("    editor_focus(editor_obj);")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("  else {")
'            mScript.Add("    config.mode = ""wysiwyg"";")
'            mScript.Add("    var contents = editor_obj.value;")
'            mScript.Add("    if (mode == 'init') { contents = document.all[objname].value; } ")
'            mScript.Add("")
'            mScript.Add("    editor_obj.outerHTML = RichEdit;")
'            mScript.Add("    editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("    var html = """";")
'            mScript.Add("    html += '<html><head>\\n';")
'            mScript.Add("    if (config.stylesheet) {")
'            mScript.Add("      html += '<link href=""' +config.stylesheet+ '"" rel=""stylesheet"" type=""text/css"">\\n';")
'            mScript.Add("    }")
'            mScript.Add("    html += '<style>\\n';")
'            mScript.Add("    html += 'body {' +config.bodyStyle+ '} \\n';")
'            mScript.Add("    for (var i in config.fontstyles) {")
'            mScript.Add("      var fontstyle = config.fontstyles[i];")
'            mScript.Add("      if (fontstyle.classStyle) {")
'            mScript.Add("        html += '.' +fontstyle.className+ ' {' +fontstyle.classStyle+ '}\\n';")
'            mScript.Add("      }")
'            mScript.Add("    }")
'            mScript.Add("    html += '</style>\\n'")
'            mScript.Add("      + '</head>\\n'")
'            mScript.Add("      + '<body contenteditable=""true"" topmargin=1 leftmargin=1'")
'            mScript.Add("")
'            mScript.Add("      +'>'")
'            mScript.Add("      + contents")
'            mScript.Add("      + '</body>\\n'")
'            mScript.Add("      + '</html>\\n';")
'            mScript.Add("")
'            mScript.Add("    var editdoc = editor_obj.contentWindow.document;")
'            mScript.Add("")
'            mScript.Add("    editdoc.open();")
'            mScript.Add("    editdoc.write(html);")
'            mScript.Add("    editdoc.close();")
'            mScript.Add("")
'            mScript.Add("    editor_updateToolbar(objname, ""enable"");  ")
'            mScript.Add("")
'            mScript.Add("    editdoc.objname = objname;")
'            mScript.Add("")
'            mScript.Add("    editdoc.onkeydown      = function() { editor_event(objname); }")
'            mScript.Add("    editdoc.onkeypress     = function() { editor_event(objname); }")
'            mScript.Add("    editdoc.onkeyup        = function() { editor_event(objname); }")
'            mScript.Add("    editdoc.onmouseup      = function() { editor_event(objname); }")
'            mScript.Add("    editdoc.body.ondrop    = function() { editor_event(objname, 100); }     ")
'            mScript.Add("    editdoc.body.oncut     = function() { editor_event(objname, 100); }")
'            mScript.Add("    editdoc.body.onpaste   = function() { editor_event(objname, 100); }")
'            mScript.Add("    editdoc.body.onblur    = function() { editor_event(objname, -1); }")
'            mScript.Add("")
'            mScript.Add("    if (mode != 'init') {             ")
'            mScript.Add("      editor_focus(editor_obj);")
'            mScript.Add("    }")
'            mScript.Add("")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  if (mode != 'init') {             ")
'            mScript.Add("    editor_event(objname);")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_focus(editor_obj) {")
'            mScript.Add("")
'            mScript.Add("  if (editor_obj.tagName.toLowerCase() == 'textarea') {         ")
'            mScript.Add("    var myfunc = function() { editor_obj.focus(); };")
'            mScript.Add("    setTimeout(myfunc,100);                                     ")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  else {                                                        ")
'            mScript.Add("    var editdoc = editor_obj.contentWindow.document;           ")
'            mScript.Add("    var editorRange = editdoc.body.createTextRange();           ")
'            mScript.Add("    var curRange    = editdoc.selection.createRange();          ")
'            mScript.Add("")
'            mScript.Add("    if (curRange.length == null &&                              ")
'            mScript.Add("        !editorRange.inRange(curRange)) {                       ")
'            mScript.Add("      editorRange.collapse();                                   ")
'            mScript.Add("      editorRange.select();                                     ")
'            mScript.Add("      curRange = editorRange;")
'            mScript.Add("    }")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_about(objname) {")
'            mScript.Add("  showModalDialog(_editor_url + """ & Popup_about_html & """, window, ""resizable: yes; help: no; status: no; scroll: no; "");")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function _dec_to_rgb(value) {")
'            mScript.Add("  var hex_string = """";")
'            mScript.Add("  for (var hexpair = 0; hexpair < 3; hexpair++) {")
'            mScript.Add("    var myByte = value & 0xFF;            ")
'            mScript.Add("    value >>= 8;                        ")
'            mScript.Add("    var nybble2 = myByte & 0x0F;          ")
'            mScript.Add("    var nybble1 = (myByte >> 4) & 0x0F;   ")
'            mScript.Add("    hex_string += nybble1.toString(16); ")
'            mScript.Add("    hex_string += nybble2.toString(16); ")
'            mScript.Add("  }")
'            mScript.Add("  return hex_string.toUpperCase();")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_insertHTML(objname, str1,str2, reqSel) {")
'            mScript.Add("  var config     = document.all[objname].config;")
'            mScript.Add("  var editor_obj = document.all[""_"" +objname + ""_editor""];    ")
'            mScript.Add("  if (str1 == null) { str1 = ''; }")
'            mScript.Add("  if (str2 == null) { str2 = ''; }")
'            mScript.Add("")
'            mScript.Add("  if (document.all[objname] && editor_obj == null) {")
'            mScript.Add("    document.all[objname].focus();")
'            mScript.Add("    document.all[objname].value = document.all[objname].value + str1 + str2;")
'            mScript.Add("    return;")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  if (editor_obj == null) { return alert(""Unable to insert HTML.  Invalid object name '"" +objname+ ""'.""); }")
'            mScript.Add("")
'            mScript.Add("  editor_focus(editor_obj);")
'            mScript.Add("")
'            mScript.Add("  var tagname = editor_obj.tagName.toLowerCase();")
'            mScript.Add("  var sRange;")
'            mScript.Add("")
'            mScript.Add("  if (tagname == 'iframe') {")
'            mScript.Add("    var editdoc = editor_obj.contentWindow.document;")
'            mScript.Add("    sRange  = editdoc.selection.createRange();")
'            mScript.Add("    var sHtml   = sRange.htmlText;")
'            mScript.Add("")
'            mScript.Add("    if (sRange.length) { return alert(""Unable to insert HTML.  Try highlighting content instead of selecting it.""); }")
'            mScript.Add("")
'            mScript.Add("    var oldHandler = window.onerror;")
'            mScript.Add("    window.onerror = function() { alert(""Unable to insert HTML for current selection.""); return true; } ")
'            mScript.Add("    if (sHtml.length) {                                 ")
'            mScript.Add("      if (str2) { sRange.pasteHTML(str1 +sHtml+ str2) } ")
'            mScript.Add("      else      { sRange.pasteHTML(str1); }             ")
'            mScript.Add("    } else {                                            ")
'            mScript.Add("      if (reqSel) { return alert(""Unable to insert HTML.  You must select something first.""); }")
'            mScript.Add("      sRange.pasteHTML(str1 + str2);                    ")
'            mScript.Add("    }")
'            mScript.Add("    window.onerror = oldHandler;")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  else if (tagname == 'textarea') {")
'            mScript.Add("    editor_obj.focus();")
'            mScript.Add("    sRange  = document.selection.createRange();")
'            mScript.Add("    var sText   = sRange.text;")
'            mScript.Add("")
'            mScript.Add("    if (sText.length) {                                 ")
'            mScript.Add("      if (str2) { sRange.text = str1 +sText+ str2; }  ")
'            mScript.Add("      else      { sRange.text = str1; }               ")
'            mScript.Add("    } else {                                            ")
'            mScript.Add("      if (reqSel) { return alert(""Unable to insert HTML.  You must select something first.""); }")
'            mScript.Add("      sRange.text = str1 + str2;                        ")
'            mScript.Add("    }")
'            mScript.Add("  }")
'            mScript.Add("  else { alert(""Unable to insert HTML.  Unknown object tag type '"" +tagname+ ""'.""); }")
'            mScript.Add("")
'            mScript.Add("  sRange.collapse(false); ")
'            mScript.Add("  sRange.select();        ")
'            mScript.Add("")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_getHTML(objname) {")
'            mScript.Add("  var editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.Add("  var isTextarea = (editor_obj.tagName.toLowerCase() == 'textarea');")
'            mScript.Add("")
'            mScript.Add("  if (isTextarea) { return editor_obj.value; }")
'            mScript.Add("  else            { return editor_obj.contentWindow.document.body.innerHTML; }")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_setHTML(objname, html) {")
'            mScript.Add("  var editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.Add("  var isTextarea = (editor_obj.tagName.toLowerCase() == 'textarea');")
'            mScript.Add("")
'            mScript.Add("  if (isTextarea) { editor_obj.value = html; }")
'            mScript.Add("  else            { editor_obj.contentWindow.document.body.innerHTML = html; }")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_appendHTML(objname, html) {")
'            mScript.Add("  var editor_obj = document.all[""_"" +objname + ""_editor""];")
'            mScript.Add("  var isTextarea = (editor_obj.tagName.toLowerCase() == 'textarea');")
'            mScript.Add("")
'            mScript.Add("  if (isTextarea) { editor_obj.value += html; }")
'            mScript.Add("  else            { editor_obj.contentWindow.document.body.innerHTML += html; }")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function _isMouseOver(obj,event) {       ")
'            mScript.Add("  var mouseX    = event.clientX;")
'            mScript.Add("  var mouseY    = event.clientY;")
'            mScript.Add("")
'            mScript.Add("  var objTop    = obj.offsetTop;")
'            mScript.Add("  var objBottom = obj.offsetTop + obj.offsetHeight;")
'            mScript.Add("  var objLeft   = obj.offsetLeft;")
'            mScript.Add("  var objRight  = obj.offsetLeft + obj.offsetWidth;")
'            mScript.Add("")
'            mScript.Add("  if (mouseX >= objLeft && mouseX <= objRight &&")
'            mScript.Add("      mouseY >= objTop  && mouseY <= objBottom) { return true; }")
'            mScript.Add("")
'            mScript.Add("  return false;")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_cMenu_generate(editorWin,objname) {")
'            mScript.Add("  var parentWin = window;")
'            mScript.Add("  editorWin.event.returnValue = false;  ")
'            mScript.Add("")
'            mScript.Add("  var cMenuOptions = [ ")
'            mScript.Add("    ['Cut', 'Ctrl-X', function() {}],")
'            mScript.Add("    ['Copy', 'Ctrl-C', function() {}],")
'            mScript.Add("    ['Paste', 'Ctrl-C', function() {}],")
'            mScript.Add("    ['Delete', 'DEL', function() {}],")
'            mScript.Add("    ['---', null, null],")
'            mScript.Add("    ['Select All', 'Ctrl-A', function() {}],")
'            mScript.Add("    ['Clear All', '', function() {}],")
'            mScript.Add("    ['---', null, null],")
'            mScript.Add("    ['About this editor...', '', function() {")
'            mScript.Add("      alert(""about this editor"");")
'            mScript.Add("    }]];")
'            mScript.Add("    editor_cMenu.options = cMenuOptions; ")
'            mScript.Add("")
'            mScript.Add("  var cMenuHeader = ''")
'            mScript.Add("    + '<div id=""_'+objname+'_cMenu"" onblur=""editor_cMenu(this);"" oncontextmenu=""return false;"" onselectstart=""return false""'")
'            mScript.Add("    + '  style=""position: absolute; visibility: hidden; cursor: default; width: 167px; background-color: threedface;'")
'            mScript.Add("    + '         border: solid 1px; border-color: threedlightshadow threeddarkshadow threeddarkshadow threedlightshadow;"">'")
'            mScript.Add("    + '<table border=0 cellspacing=0 cellpadding=0 width=""100%"" style=""width: 167px; background-color: threedface; border: solid 1px; border-color: threedhighlight threedshadow threedshadow threedhighlight;"">'")
'            mScript.Add("    + ' <tr><td colspan=2 height=1></td></tr>';")
'            mScript.Add("")
'            mScript.Add("  var cMenuList = '';")
'            mScript.Add("")
'            mScript.Add("  var cMenuFooter = ''")
'            mScript.Add("    + ' <tr><td colspan=2 height=1></td></tr>'")
'            mScript.Add("    + '</table></div>';")
'            mScript.Add("")
'            mScript.Add("  for (var menuIdx in editor_cMenu.options) {")
'            mScript.Add("    var menuName = editor_cMenu.options[menuIdx][0];")
'            mScript.Add("    var menuKey  = editor_cMenu.options[menuIdx][1];")
'            mScript.Add("    var menuCode = editor_cMenu.options[menuIdx][2];")
'            mScript.Add("")
'            mScript.Add("    if (menuName == ""---"" || menuName == ""separator"") {")
'            mScript.Add("      cMenuList += ' <tr><td colspan=2 class=""cMenuDivOuter""><div class=""cMenuDivInner""></div></td></tr>';")
'            mScript.Add("    }")
'            mScript.Add("")
'            mScript.Add("    else {")
'            mScript.Add("      cMenuList += '<tr class=""cMenu"" onMouseOver=""editor_cMenu(this)"" onMouseOut=""editor_cMenu(this)"" onClick=""editor_cMenu(this, \\'' +menuIdx+ '\\',\\'' +objname+ '\\')"">';")
'            mScript.Add("      if (menuKey) { cMenuList += ' <td align=left class=""cMenu"">' +menuName+ '</td><td align=right class=""cMenu"">' +menuKey+ '</td>'; }")
'            mScript.Add("      else         { cMenuList += ' <td colspan=2 class=""cMenu"">' +menuName+ '</td>'; }")
'            mScript.Add("      cMenuList += '</tr>';")
'            mScript.Add("    }")
'            mScript.Add("  }")
'            mScript.Add("")
'            mScript.Add("  var cMenuHTML = cMenuHeader + cMenuList + cMenuFooter;")
'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("  document.all['_'+objname+'_cMenu'].outerHTML = cMenuHTML;")
'            mScript.Add("")
'            mScript.Add("  editor_cMenu_setPosition(parentWin, editorWin, objname);")
'            mScript.Add("")
'            mScript.Add("  parentWin['_'+objname+'_cMenu'].style.visibility = 'visible';")
'            mScript.Add("  parentWin['_'+objname+'_cMenu'].focus();")
'            mScript.Add("")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_cMenu_setPosition(parentWin, editorWin, objname) {      ")
'            mScript.Add("  var event    = editorWin.event;")
'            mScript.Add("  var cMenuObj = parentWin['_'+objname+'_cMenu'];")
'            mScript.Add("  var mouseX   = event.clientX + parentWin.document.all['_'+objname+'_editor'].offsetLeft;")
'            mScript.Add("  var mouseY   = event.clientY + parentWin.document.all['_'+objname+'_editor'].offsetTop;")
'            mScript.Add("  var cMenuH   = cMenuObj.offsetHeight;")
'            mScript.Add("  var cMenuW   = cMenuObj.offsetWidth;")
'            mScript.Add("  var pageH    = document.body.clientHeight + document.body.scrollTop;")
'            mScript.Add("  var pageW    = document.body.clientWidth + document.body.scrollLeft;")
'            mScript.Add("")
'            mScript.Add("  if (mouseX + 5 + cMenuW > pageW) { var left = mouseX - cMenuW - 5; } ")
'            mScript.Add("  else                            { var left = mouseX + 5; }")
'            mScript.Add("")
'            mScript.Add("  if (mouseY + 5 + cMenuH > pageH) { var top = mouseY - cMenuH + 5; } ")
'            mScript.Add("  else                            { var top = mouseY + 5; }")
'            mScript.Add("")
'            mScript.Add("  cMenuObj.style.top = top;")
'            mScript.Add("  cMenuObj.style.left = left;")
'            mScript.Add("")
'            mScript.Add("}")

'            mScript.Add("")
'            mScript.Add("")
'            mScript.Add("function editor_cMenu(obj,menuIdx,objname) {")
'            mScript.Add("  var action = event.type;")
'            mScript.Add("  if      (action == ""mouseover"" && !obj.disabled && obj.tagName.toLowerCase() == 'tr') {")
'            mScript.Add("    obj.className = 'cMenuOver';")
'            mScript.Add("    for (var i=0; i < obj.cells.length; i++) { obj.cells[i].className = 'cMenuOver'; }")
'            mScript.Add("  }")
'            mScript.Add("  else if (action == ""mouseout"" && !obj.disabled && obj.tagName.toLowerCase() == 'tr')  {")
'            mScript.Add("    obj.className = 'cMenu';")
'            mScript.Add("    for (var i=0; i < obj.cells.length; i++) { obj.cells[i].className = 'cMenu'; }")
'            mScript.Add("  }")
'            mScript.Add("  else if (action == ""click"" && !obj.disabled) {")
'            mScript.Add("    document.all['_'+objname+'_cMenu'].style.visibility = ""hidden"";")
'            mScript.Add("    var menucode = editor_cMenu.options[menuIdx][2];")
'            mScript.Add("    menucode();")
'            mScript.Add("  }")
'            mScript.Add("  else if (action == ""blur"") {")
'            mScript.Add("    if (!_isMouseOver(obj,event)) { obj.style.visibility = 'hidden'; }")
'            mScript.Add("    else {")
'            mScript.Add("      if (obj.style.visibility != ""hidden"") { obj.focus(); }")
'            mScript.Add("    }")
'            mScript.Add("  }")
'            mScript.Add("  else { alert(""editor_cMenu, unknown action: "" + action); }")
'            mScript.Add("}")
'            mScript.Add("")

'            '''TODO
'            'mScript.Add("-->")
'            mScript.Add("</script>")

'            'NEW WINDOW BODY START HERE
'            mScript.Add("<script>")

'            '''TODO
'            'mScript.Add("<!--")

'            mScript.Add("if (window.dialogArguments) {")
'            mScript.Add("	opener = window.dialogArguments; ")
'            mScript.Add("}")

'            mScript.Add("var parent_objname ") '= location.search.substring(1,location.search.length);")
'            mScript.Add("parent_objname = ParentTextAreaName;") 'parent_objname.split(""?"")[1];")
'            mScript.Add("var parent_config  = opener.document.all[parent_objname].config;")
'            'mScript.Add("var config         = cloneObject( parent_config );")
'            mScript.Add("var objname        = 'editor';")
'            mScript.Add("var config = new editor_defaultConfig(objname);")

'            mScript.Add("function _CloseOnEsc() {")
'            mScript.Add("  if (event.keyCode == 27) {")
'            mScript.Add("    update_parent();")
'            mScript.Add("    window.close();")
'            mScript.Add("    return;")
'            mScript.Add("  }")
'            mScript.Add("}")


'            mScript.Add("function cloneObject(obj) {")
'            mScript.Add("  var newObj          = new Object; ")

'            mScript.Add("  if (obj.constructor.toString().indexOf('function Array(') == 1) {")
'            mScript.Add("    newObj = obj.constructor();")
'            mScript.Add("  }")

'            mScript.Add("  for (var n in obj) {")
'            mScript.Add("    var node = obj[n];")
'            mScript.Add("    if (typeof node == 'object') { newObj[n] = cloneObject(node); }")
'            mScript.Add("    else                         { newObj[n] = node; }")
'            mScript.Add("  }")

'            mScript.Add("  return newObj;")
'            mScript.Add("}")

'            mScript.Add("function resize_editor() {  ")
'            mScript.Add("  var editor = document.all['_editor_editor'];")

'            mScript.Add("  newWidth  = document.body.offsetWidth;")
'            mScript.Add("  newHeight = document.body.offsetHeight - editor.offsetTop;")

'            mScript.Add("  if (newWidth < 0) { newWidth = 0; }")
'            mScript.Add("  if (newHeight < 0) { newHeight = 0; }")

'            mScript.Add("  editor.style.width  = newWidth;")
'            mScript.Add("  editor.style.height = newHeight;")
'            mScript.Add("}")

'            mScript.Add("function init() {")
'            mScript.Add("var config = new editor_defaultConfig(objname);")
'            mScript.Add("  config.btnList[""popupeditor""] = ['popupeditor', 'Minimize Editor',  'update_parent(); window.close();', '" & Images_fullscreen_minimize_gif & "'];")

'            mScript.Add("  config.btnList[""htmlmode""]    = ['HtmlMode',    'View HTML Source', 'editor_setmode(\\'editor\\')',  '" & Images_ed_html_gif & "'];")

'            'mScript.add("  config.imgURL = ""../images/"";")

'            mScript.Add("  editor_generate('editor',config);")
'            mScript.Add("  resize_editor();")

'            mScript.Add("  if (parent_config.mode == 'textedit') { editor_setmode(objname, 'textedit'); }")

'            mScript.Add("  var parentHTML = opener.editor_getHTML(parent_objname);")
'            mScript.Add("  editor_setHTML(objname, parentHTML);")

'            mScript.Add("  window.setInterval(update_parent, 333);")

'            mScript.Add("  document.body.onkeypress = _CloseOnEsc;")
'            mScript.Add("  window.onresize = resize_editor;")
'            mScript.Add("}")

'            mScript.Add("function update_parent() {")
'            'mScript.Add("  alert('update_parent');")
'            mScript.Add("  var childHTML = editor_getHTML(objname);")
'            mScript.Add("  opener.editor_setHTML(parent_objname, childHTML);")
'            mScript.Add("}")


'            '''TODO
'            'mScript.Add("-->")
'            mScript.Add("</script>")
'            mScript.Add("</head>")
'            mScript.Add("<body scroll=""no"" onload=""init()"" onunload=""update_parent()"">")
'            'mScript.add("<body scroll=""no"" onload=""alert('onload')"" onunload=""alert('onunload')"">")

'            mScript.Add("<div style=""margin: 0 0 0 0; border-width: 1; border-style: solid; border-color: threedshadow threedhighlight threedhighlight threedshadow; ""></div>")

'            mScript.Add("<textarea name=""editor"" style=""width:100%; height:300px""></textarea><br/>")

'            'mScript.Add("<script language=""javascript"">init();</script>")
'            mScript.Add("</body></html>")

'            Return mScript
'        End Function

'    End Class
'End Namespace